(function(){function t(e){return t.enabled(e)?function(n){var r=new Date,i=r-(t[e]||r);t[e]=r,n=e+" "+n+" +"+t.humanize(i),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function n(t,r){var i=n.resolve(t),s=n.modules[i];if(!s)throw new Error('failed to require "'+t+'" from '+r);return s.exports||(s.exports={},s.call(s.exports,s,s.exports,n.relative(i),e)),s.exports}var e=this;t.names=[],t.skips=[],t.enable=function(e){localStorage.debug=e;var n=(e||"").split(/[\s,]+/),r=n.length;for(var i=0;i<r;i++)e=n[i].replace("*",".*?"),e[0]==="-"?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$"))},t.disable=function(){t.enable("")},t.humanize=function(e){var t=1e3,n=6e4,r=60*n;return e>=r?(e/r).toFixed(1)+"h":e>=n?(e/n).toFixed(1)+"m":e>=t?(e/t|0)+"s":e+"ms"},t.enabled=function(e){for(var n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(var n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},window.localStorage&&t.enable(localStorage.debug),n.modules={},n.resolve=function(e){var t=e,r=e+".js",i=e+"/index.js";return n.modules[r]&&r||n.modules[i]&&i||t},n.register=function(e,t){n.modules[e]=t},n.relative=function(e){return function(r){if("debug"==r)return t;if("."!=r.charAt(0))return n(r);var i=e.split("/"),s=r.split("/");i.pop();for(var o=0;o<s.length;o++){var u=s[o];".."==u?i.pop():"."!=u&&i.push(u)}return n(i.join("/"),e)}},n.register("app.js",function(e,t,n,r){var i=n("./game"),s=n("./simulator");(new i).pushState(new s(document.getElementById("canv"))).run()}),n.register("body.js",function(e,t,n,r){function s(e,t,n){var r=n/7.5,s=r*3/4,u=new i(e+o(-5,5),t+o(-5,5),4),a=new i(e+o(-5,5),t+o(-5,5),26);u.attachTo(a,5/4*r,1,n*2);var f=new i(e+o(-5,5),t+o(-5,5),2),l=new i(e+o(-5,5),t+o(-5,5),2);f.attachTo(a,r*3/2,1,n*2),l.attachTo(a,r*3/2,1,n*2);var c=new i(e+o(-5,5),t+o(-5,5),2),h=new i(e+o(-5,5),t+o(-5,5),2);c.attachTo(f,r*2,1,n*2),h.attachTo(l,r*2,1,n*2);var p=new i(e+o(-5,5),t+o(-5,5),15);p.attachTo(a,r*3.5,.8,n*2),p.attachTo(u,r*4.75,.02,n*2).hidden=!0;var d=new i(e+o(-5,5),t+o(-5,5),10),v=new i(e+o(-5,5),t+o(-5,5),10);d.attachTo(p,r*2,1,n*2),v.attachTo(p,r*2,1,n*2);var m=new i(e+o(-5,5),t+o(-5,5),5),g=new i(e+o(-5,5),t+o(-5,5),5);m.attachTo(d,r*2,1,n*2),g.attachTo(v,r*2,1,n*2),m.attachTo(a,r*7.5,.001,n*2).hidden=!0,g.attachTo(a,r*7.5,.001,n*2).hidden=!0,this.head=u,this.shoulder=a,this.pelvis=p,this.elbowLeft=f,this.elbowRight=l,this.handLeft=c,this.handRight=h,this.kneeLeft=d,this.kneeRight=v,this.footLeft=m,this.footRight=g}function o(e,t){return e+Math.random()*(t-e)}var i=n("./point-mass");e.exports=s,s.prototype.setBounds=function(e){this.head.bounds=e,this.shoulder.bounds=e,this.pelvis.bounds=e,this.elbowLeft.bounds=e,this.elbowRight.bounds=e,this.handLeft.bounds=e,this.handRight.bounds=e,this.kneeLeft.bounds=e,this.kneeRight.bounds=e,this.footLeft.bounds=e,this.footRight.bounds=e},s.prototype.addToWorld=function(e){e.push(this.head),e.push(this.shoulder),e.push(this.pelvis),e.push(this.elbowLeft),e.push(this.elbowRight),e.push(this.handLeft),e.push(this.handRight),e.push(this.kneeLeft),e.push(this.kneeRight),e.push(this.footLeft),e.push(this.footRight)},s.prototype.removeFromWorld=function(e){function t(t){var n=e.indexOf(t);~n&&e.splice(n,1)}t(this.head),t(this.shoulder),t(this.pelvis),t(this.elbowLeft),t(this.elbowRight),t(this.handLeft),t(this.handRight),t(this.kneeLeft),t(this.kneeRight),t(this.footLeft),t(this.footRight)}}),n.register("game.js",function(e,t,n,r){function u(){this.inputs=new s,this.states=[],this.current=null}var i=n("./request-animation-frame"),s=n("./inputs"),o=n("debug")("game");e.exports=u,u.prototype.pushState=function(e){o("pushState");if(typeof e!="object")throw new Error("invalid state. must be object.");return this.states.push(e),this.current=e,e.game=this,e.create&&e.create(),this},u.prototype.popState=function(){o("popState");var e=this.current;return e.destroy&&e.destroy(),delete e.game,this.current=this.states.pop(),this},u.prototype.isState=function(e){return e===this.current},u.prototype.switchState=function(e){o("switchState"),this.popState().pushState(e)},u.prototype.run=function(){function u(){i(u);var a=Date.now()/1e3,f=a-n,l=.25;n=a;var c=s.current;if(!c){console.error("no more states. done!"),o("stop");return}f>l&&(f=l),r+=f;while(r>=t)c.game&&c.controls&&c.controls(s.inputs),c.game&&c.update&&c.update(t,e),e+=t,r-=t;c.game&&c.render&&c.render(r/t)}if(!this.current)throw new Error("no current state. must pushState() first.");o("run");var e=0,t=1/60,n=0,r=0,s=this;return u(),this}}),n.register("inputs.js",function(e,t,n,r){function s(){this.mouse=new i,this.mouse.last=new i,this.touches=[],this.keyboard={};var e=this;document&&(document.addEventListener("mousedown",function(t){t.preventDefault(),e.onmousedown(t)},!1),document.addEventListener("mousemove",function(t){t.preventDefault(),e.onmousemove(t)},!1),document.addEventListener("mouseup",function(t){t.preventDefault(),e.onmouseup(t)},!1))}var i=n("./point");e.exports=s,s.prototype.onmousedown=function(e){this.mouse.down=!0,this.mouse.up=!1},s.prototype.onmouseup=function(e){this.mouse.down=!1,this.mouse.up=!0},s.prototype.onmousemove=function(e){this.mouse.last.set(this.mouse),this.mouse.set(e.offsetX,e.offsetY)}}),n.register("link.js",function(e,t,n,r){function s(e,t,n,r,i){if(!e)throw new Error("invalid point mass a");if(!t)throw new Error("invalid point mass b");if(typeof n!="number")throw new Error("resting difference must be a number");if(typeof r!="number")throw new Error("stiffness must be a number");if(typeof i!="number")throw new Error("tear sensitivity must be a number");this.a=e,this.b=t,this.restingDistance=n,this.stiffness=r,this.tearSensitivity=i}var i=n("./point");e.exports=s,s.prototype={solve:function(){var e=i.diff(this.b.current,this.a.current),t=e.length,n=(this.restingDistance-t)/t;t>this.tearSensitivity&&this.a.removeLink(this);var r=1/this.a.mass,s=1/this.b.mass,o=r/(r+s)*this.stiffness,u=this.stiffness-o;this.a.current.add(e.x*o*n,e.y*o*n),this.b.current.sub(e.x*u*n,e.y*u*n)}}}),n.register("physics.js",function(e,t,n,r){function i(){this.pointMasses=[],this.constraintAccuracy=3}e.exports=i,i.prototype={update:function(e){for(var t=0;t<this.constraintAccuracy;t++)for(var n=0;n<this.pointMasses.length;n++)this.pointMasses[n].solveConstraints();for(var t=0;t<this.pointMasses.length;t++)this.pointMasses[t].update(e)}}}),n.register("point-mass.js",function(e,t,n,r){function o(e,t,n){this.previous=new i(e,t),this.current=new i(e,t),this.acceleration=new i,this.velocity=new i,this.mass=n||1,this.damping=1,this.links=[],this.bounds=null,this._pinned=null,this._next=new i}var i=n("./point"),s=n("./link");e.exports=o,o.prototype={update:function(e){var t=e*e;this.velocity.set(this.current.x-this.previous.x,this.current.y-this.previous.y).mul(.99),this._next.set(this.current.x+this.velocity.x+.5*this.acceleration.x*t,this.current.y+this.velocity.y+.5*this.acceleration.y*t),this.previous.set(this.current),this.current.set(this._next),this.acceleration.reset()},solveConstraints:function(){for(var e=0;e<this.links.length;e++)this.links[e].solve();this.bounds&&this.bounds.restrain(this.current),this._pinned&&this.current.set(this._pinned)},attachTo:function(e,t,n,r){if(this===e)throw new Error("cannot attach to itself");if(e instanceof o){var i=new s(this,e,t,n,r);return this.links.push(i),i}throw new Error("must attach to PointMass")},removeLink:function(e){var t=this.links.indexOf(e);return this.links.splice(t,1),e},applyForce:function(e,t){this.acceleration.add(e/this.mass,t/this.mass)},pinTo:function(e,t){this._pinned?this._pinned.set(e,t):this._pinned=new i(e,t)}}}),n.register("point.js",function(e,t,n,r){function i(e,t){if(!(this instanceof i))return new i(e,t);typeof e=="object"&&(t=e.y,e=e.x),this.x=e||0,this.y=t||0}e.exports=i,i.prototype={set:function(e,t){if(e instanceof i)this.x=e.x,this.y=e.y;else if(arguments.length==1)this.x=e,this.y=e;else{if(arguments.length!=2)throw new Error("invalid arguments");this.x=e,this.y=t}return this},add:function(e,t){if(e instanceof i)this.x+=e.x,this.y+=e.y;else if(arguments.length==1)this.x+=e,this.y+=e;else{if(arguments.length!=2)throw new Error("invalid arguments");this.x+=e,this.y+=t}return this},sub:function(e,t){if(e instanceof i)this.x-=e.x,this.y-=e.y;else if(arguments.length==1)this.x-=e,this.y-=e;else{if(arguments.length!=2)throw new Error("invalid arguments");this.x-=e,this.y-=t}return this},mul:function(e,t){if(e instanceof i)this.x*=e.x,this.y*=e.y;else if(arguments.length==1)this.x*=e,this.y*=e;else{if(arguments.length!=2)throw new Error("invalid arguments");this.x*=e,this.y*=t}return this},div:function(e,t){if(e instanceof i)this.x/=e.x,this.y/=e.y;else if(arguments.length==1)this.x/=e,this.y/=e;else{if(arguments.length!=2)throw new Error("invalid arguments");this.x/=e,this.y/=t}return this},get length(){return Math.sqrt(this.x*this.x+this.y*this.y)},reset:function(){return this.x=0,this.y=0,this},clone:function(){return new i(this.x,this.y)},copy:function(e){return e&&(this.x=e.x||this.x,this.y=e.y||this.y),this},validate:function(){if(typeof this.x!="number")throw new Error("invalid x:"+this.x);if(typeof this.y!="number")throw new Error("invalid y:"+this.y);return this},toString:function(){return"("+this.x+","+this.y+")"}},i.prototype.multiply=i.prototype.mul,i.prototype.subtract=i.prototype.sub,i.prototype.divide=i.prototype.div,i.polar=function(e,t){var n=Math.PI/180;return new i(Math.sin(e*n)*t,Math.cos(e*n)*t)},i.distance=function(e,t){return i.diff(e,t).length},i.diff=function(e,t){return new i(t.x-e.x,t.y-e.y)}}),n.register("rect.js",function(e,t,n,r){function i(e,t,n,r){this.t=e,this.r=t,this.b=n,this.l=r}e.exports=i,i.prototype={within:function(e){return e.x>this.l&&e.x<this.r&&e.y>this.t&&e.y<this.b},restrain:function(e){e.y<this.t&&(e.y=2*this.t-e.y),e.y>this.b&&(e.y=2*this.b-e.y),e.x<this.l&&(e.x=2*this.l-e.x),e.x>this.r&&(e.x=2*this.r-e.x)}}}),n.register("renderer.js",function(e,t,n,r){function i(e){this.pointMasses=[],this.canvas=e,this.context=e.getContext("2d"),this.stats={pointMass:0,links:0}}e.exports=i,i.prototype={drawPointMass:function(e){if(e.links.length)for(var t=0,n=e.links.length;t<n;t++)this.drawLink(e.links[t]);else this.context.rect(e.current.x,e.current.y,1,1);this.stats.pointMass++},drawLink:function(e){e.hidden||(this.context.moveTo(e.a.current.x,e.a.current.y),this.context.lineTo(e.b.current.x,e.b.current.y),this.stats.links++)},clear:function(){this.canvas.width=this.canvas.width},render:function(){this.stats.pointMass=0,this.stats.links=0,this.context.strokeStyle="#000";for(var e=0,t=this.pointMasses.length;e<t;e++)this.drawPointMass(this.pointMasses[e]);this.context.stroke()}}}),n.register("request-animation-frame.js",function(e,t,n,r){var i=function(e){setTimeout(e,1e3/60)};e.exports=typeof window!="undefined"?window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||i:i}),n.register("simulator.js",function(e,t,n,r){function l(e){this.width=e.width,this.height=e.height,this.bounds=new a(1,this.width-1,this.height-1,1),this.physics=new i,this.renderer=new s(e),this.reset()}function c(e,t,n){var r=u.diff(n,e),i=u.diff(t,e),s=i.x*i.x+i.y*i.y,o=-r.x*i.x+ -r.y*i.y;return o<0||o>s?(i.set(t.x-n.x,t.y-n.y),Math.min(r.x*r.x+r.y*r.y,i.x*i.x+i.y*i.y)):(o=i.x*r.y-i.y*r.x,o*o/s)}var i=n("./physics"),s=n("./renderer"),o=n("./point-mass"),u=n("./point"),a=n("./rect"),f=n("./body");e.exports=l,l.prototype={createCurtain:function(e,t){var n=6,r=1,i=50,s=25,u=this.width/2-e*n/2;for(var a=0;a<=t;a++)for(var f=0;f<=e;f++){var l=new o(u+f*n,a*n+s);f!=0&&l.attachTo(this.pointMasses[this.pointMasses.length-1],n,r,i),a!=0&&l.attachTo(this.pointMasses[(a-1)*(e+1)+f],n,r,i),a==0&&l.pinTo(l.current.x,l.current.y),l.bounds=this.bounds,this.pointMasses.push(l)}},createBodies:function(e){var t=40;for(var n=0;n<e;n++){var r=Math.random()*this.width,i=Math.random()*this.height,s=new f(r,i,t);s.setBounds(this.bounds),s.addToWorld(this.pointMasses)}},reset:function(){this.pointMasses=this.physics.pointMasses=this.renderer.pointMasses=[],this.createCurtain(60,40),this.createBodies(25)},controls:function(e){this.pointMasses.forEach(function(t){t.applyForce(0,980);if(e.mouse.down){var n=400,r=2,i=c(e.mouse.last,e.mouse,t.current);i<n&&t.previous.set(t.current.x-(e.mouse.x-e.mouse.last.x)*r,t.current.y-(e.mouse.y-e.mouse.last.y)*r)}})},update:function(e,t){this.physics.update(e)},render:function(){this.renderer.clear(),this.renderer.render()}}}),app=n("app")})();