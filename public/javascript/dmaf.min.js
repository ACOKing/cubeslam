(function(e){var t=!1,n=!1,r={},i,s=Array.prototype.slice,o={pendingObjects:{},failure:function(){var e=function(){console.log("DMAF failed to load.")};o.dispatch("dmaf_fail");for(var t in dmaf)dmaf.hasOwnProperty(t)&&(dmaf[t]=e)},dispatch:function(e){var o=r,u=i,a=[],f=s.call(arguments,1);i=e,n=!1,o=r[e],o||(o=a);for(var l=0;l<o.length;l++){a.push(o[l].apply(o[l].context,f)),t&&(l--,t=!1);if(n)break}return i=u,a.length?a:null}};e.dmaf=e.dmaf||{},dmaf.pending=[],dmaf.tell=function(e,t,n){if(!dmaf.active)return dmaf.pending.push([].slice.call(arguments));n||(n=o.context.currentTime*1e3),o.ActionManager.onEvent(e,n,t)},dmaf.addEventListener=function(e,t,n){var i=r;i=i[e]||(i[e]=[]);for(var s=0,o=i.length;s<o;s++)if(i[s]===t)return t;t.context=n&&typeof n=="object"?n:dmaf,i.push(t)},dmaf.removeEventListener=function(e,n){var i=r,s;i=i[e];if(!i||!i.length)return;s=i.length;while(s--)if(i[s]==n){i.splice(s,1),t=!0;break}},dmaf.once=function(e,t,n){t.context=n&&typeof n=="object"?n:dmaf;var r=function(){var i=t.apply(n,arguments);return dmaf.removeEventListener(e,r),i};dmaf.addEventListener(e,r,n)},dmaf.currentEvent=function(){return i},dmaf.stop=function(){n=!0},dmaf.registerObject=function(e,t){if(typeof e=="string"){e=o.Utils.removeWhiteSpace(e);if(!e){console.log("DMAF: You must provide a valid id for the object you wish to register.");return}}else console.log("DMAF: You must provide a valid id for the object you wish to register.");if(!t||!(t instanceof Object)){console.log("DMAF: You've tried to register an object not of type 'object'");return}t.instanceId||(t.instanceId=e),o.pendingObjects[e]=t,o.ActionManager.onEvent(e+".CREATE")},dmaf.unregisterObject=function(e){var t=o.pendingObjects[e],n=!1;return t&&(n=delete o.pendingObjects[e]),t=o.getInstance("customCode:"+e),t&&(n=o.removeInstance("customCode:"+e)),t=o.getInstance("mediaElement:"+e),t&&(n=o.removeInstance("mediaElement:"+e)),n&&o.ActionManager.onEvent(e+".REMOVE"),!1},dmaf.dev?e.DMAF=o:e.addEventListener("load",function(){o.dispatch("load_framework",o)}),dmaf.once("dmaf_ready",function(){setTimeout(function(){var e=dmaf.pending.length;while(e--){var t=dmaf.pending.shift();dmaf.tell.apply(dmaf,t)}},16)})})(window),dmaf.once("load_core",function(e){e.Settings={descriptors:{validActions:["loadCustomCode","loadSound","loadMIDI","loadSampleMap","customCode","userObject","mediaElement","mediaController","genericPlay","stepPlay","soundStop","midiProcessor","makeNote","transform","macro","state","eventMapper","midiNoteMapper","timePatternPlayer","beatPatternPlayer","sampler","audioBus"],validTypes:["noteMap","stateMap","eventMap","file","map","target","sampleMapGroup","sampleMap","start","stop","beatEvent","add","band","chorus","overdrive","compressor","cabinet","filter","convolver","delay","envelopeFollower","equalizer","lfo","phaser","pingPongDelay","tremolo","wahWah"],action:{assetController:{loadCustomCode:{type:"assetController",instanceId:{name:"instanceId",type:"string"},baseURL:{name:"baseURL",type:"string"},returnEvent:{name:"returnEvent",type:"string"},files:{name:"files",type:"array",valueType:"file"}},type:"assetController",loadSound:{type:"assetController",instanceId:{name:"instanceId",type:"string"},baseURL:{name:"baseURL",type:"string"},returnEvent:{name:"returnEvent",type:"string"},files:{name:"files",type:"array",valueType:"file"}},loadMIDI:{type:"assetController",instanceId:{name:"instanceId",type:"string"},baseURL:{name:"baseURL",type:"string"},returnEvent:{name:"returnEvent",type:"string"},files:{name:"files",type:"array",valueType:"file"}},loadSampleMap:{type:"assetController",instanceId:{name:"instanceId",type:"string"},baseURL:{name:"baseURL",type:"string"},returnEvent:{name:"returnEvent",type:"string"},files:{name:"files",type:"array",valueType:"file"}}},customCode:{customCode:{type:"customCode",instanceId:{name:"instanceId",type:"string"}},type:"customCode",userObject:{type:"customCode",instanceId:{name:"instanceId",type:"string"}}},mediaElement:{mediaElement:{type:"mediaElement",instanceId:{name:"instanceId",type:"string"}},type:"mediaElement"},control:{mediaController:{type:"control",instanceId:{name:"instanceId",type:"string","default":"multi"}},type:"control"},sound:{genericPlay:{type:"sound",delay:{name:"delay",type:"int","default":0,min:-1e6,max:1e6},instanceId:{name:"instanceId",type:"string","default":"multi"},soundFile:{name:"soundFile",type:"string","default":"multi"},multiSuffix:{name:"multiSuffix",type:"string","default":""},volume:{name:"volume",type:"float",unit:"dB","default":0,min:-90,max:48},pan:{name:"pan",type:"int","default":0,min:-100,max:100},loop:{name:"loop",type:"int",unit:"mS","default":-1,min:-1,max:1e5},reTrig:{name:"reTrig",type:"int",unit:"mS","default":-1,min:-1,max:1e5},returnEvent:{name:"returnEvent",type:"string"},returnEventTime:{name:"returnEventTime",type:"int",unit:"mS","default":-1,min:-1e6,max:1e5},preListen:{name:"preListen",type:"int","default":0,min:0,max:500},bus:{name:"bus",type:"string","default":"master"},priority:{name:"priority",type:"boolean","default":!1},timingCorrection:{name:"timingCorrection",type:"enum","default":"PLAY",values:["RESYNC","SYNC","PLAY"]}},type:"sound",stepPlay:{type:"sound",delay:{name:"delay",type:"int","default":0,min:0,max:1e5},instanceId:{name:"instanceId",type:"string"},soundFiles:{name:"soundFiles",type:"list"},generator:{name:"generator",type:"enum","default":"SHUFFLE",values:["SHUFFLE","RANDOM","RANDOM_FIRST","ROUND_ROBIN"]},volume:{name:"volume",type:"float","default":0,min:-90,max:48},pan:{name:"pan",type:"int","default":0,min:-100,max:100},reTrig:{name:"reTrig",type:"int","default":-1,min:-1,max:1e5},returnEvent:{name:"returnEvent",type:"string","default":"",values:["ALL"]},returnEventTime:{name:"returnEventTime",type:"int","default":-1,min:-1e6,max:1e5},preListen:{name:"preListen",type:"int","default":0,min:0,max:500},bus:{name:"bus",type:"string","default":"master",values:["ALL"]},priority:{name:"priority",type:"boolean","default":!1},timingCorrection:{name:"timingCorrection",type:"enum","default":"SYNC",values:["SYNC","PLAY"]}},soundStop:{type:"sound",delay:{name:"delay",type:"int","default":0,min:0,max:9999999},targets:{name:"targets",type:"list"},multiSuffix:{name:"multiSuffix",type:"string","default":""}}},midiProcessor:{midiProcessor:{type:"midiProcessor",instanceId:{name:"instanceId",type:"string","default":"someProcessor"},transpose:{name:"transpose",type:"int","default":0,min:-127,max:127},dynamic:{name:"dynamic",type:"int","default":0,min:-127,max:127},quantize:{name:"quantize",type:"string"},scale:{name:"scale",type:"string","default":"major",values:["off","major","harmonicMinor","naturalMinor","majorPentatonic","minorPentatonic","dorian","phyrgian","lydian","mixolydian","locrian","doubleHarmonic","halfDim","custom","off"]},customScale:{name:"customScale",type:"string","default":"0,0,0,0,0,0,0,0,0,0,0,0"},root:{name:"root",type:"string","default":"C",values:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}},type:"midiProcessor",makeNote:{type:"midiProcessor",instanceId:{name:"instanceId",type:"string","default":"someProcessor"},noteMaps:{name:"noteMaps",type:"array",valueType:"noteMap"}}},parameterProcessor:{transform:{type:"parameterProcessor",instanceId:{name:"instanceId",type:"string"},delay:{name:"delay",type:"int","default":0,min:0,max:9999999},targetType:{name:"targetType",type:"enum","default":"SOUND",values:["sound","audioRouter","synth"]},targets:{name:"targets",type:"list"},targetParameter:{name:"targetParameter",type:"string"},multiSuffix:{name:"multiSuffix",type:"string"},value:{name:"value",type:"float","default":0,min:-9999999,max:9999999},duration:{name:"duration",type:"int","default":0,min:0,max:9999999},curve:{name:"curve",type:"int","default":0,min:-100,max:100}},type:"parameterProcessor",macro:{type:"parameterProcessor",instanceId:{name:"instanceId",type:"string"},delay:{name:"delay",type:"int","default":0,min:0,max:9999999},macroTargets:{name:"macroTargets",type:"array",valueType:"macroTarget"}}},stateProcessor:{state:{type:"stateProcessor",instanceId:{name:"instanceId",type:"string"},update:{name:"update",type:"enum","default":"onChange",values:["onChange","always"]},stateMaps:{name:"stateMaps",type:"array",valueType:"stateMap"}},type:"stateProcessor"},eventProcessor:{eventMapper:{type:"eventProcessor",instanceId:{name:"instanceId",type:"string"},eventMaps:{name:"eventMaps",type:"array",valueType:"eventMap"}},type:"eventProcessor",midiNoteMapper:{type:"eventProcessor",instanceId:{name:"instanceId",type:"string"},eventMaps:{name:"eventMaps",type:"array",valueType:"eventMap"}}},player:{timePatternPlayer:{type:"player",instanceId:{name:"instanceId",type:"string","default":"master_time_player"},behavior:{name:"behavior",type:"enum",values:["LINEAR","DEFAULT"],"default":"DEFAULT"}},type:"player",beatPatternPlayer:{type:"player",instanceId:{name:"instanceId",type:"string","default":"master_beat_player"},flowItems:{name:"flowItems",type:"array",valueType:"flowItem"}}},synth:{sampler:{type:"synth",instanceId:{name:"instanceId",type:"string"},ignoreNoteOff:{name:"ignoreNoteOff",type:"boolean","default":!1},bus:{name:"bus",type:"string","default":"master"},volume:{name:"volume",type:"int","default":0,min:-80,max:10},loop:{name:"loop",type:"boolean","default":!1},ampAttack:{name:"ampAttack",type:"int","default":0,min:0,max:500},ampDecay:{name:"ampDecay",type:"int","default":0,min:0,max:500},ampRelease:{name:"ampRelease",type:"int","default":0,min:0,max:500},ampSustain:{name:"ampSustain",type:"float","default":1,min:0,max:1},ampVelocityRatio:{name:"ampVelocityRatio",type:"float","default":1,min:0,max:1},filterOn:{name:"filterOn",type:"boolean","default":!1},filterAttack:{name:"filterAttack",type:"int","default":0,min:0,max:500},filterDecay:{name:"filterDecay",type:"int","default":0,min:0,max:500},filterRelease:{name:"filterRelease",type:"int","default":0,min:0,max:500},filterSustain:{name:"filterSustain",type:"float","default":1,min:0,max:1},filterVelocityRatio:{name:"filterVelocityRatio",type:"float","default":1,min:0,max:1},filterQ:{name:"filterQ",type:"float","default":1e-4,min:1e-4,max:30},filterFrequency:{name:"filterFrequency",type:"int","default":0,min:0,max:10},filterGain:{name:"filterGain",type:"float","default":0,min:0,max:1},audioNodes:{name:"audioNodes",type:"array",valueType:"audioNode"},sampleMapGroups:{name:"sampleMapGroups",type:"array",valueType:"sampleMapGroup"}},type:"synth"},audioRouter:{audioBus:{type:"audioRouter",instanceId:{name:"instanceId",type:"string"},outputBus:{name:"outputBus",type:"string","default":"master"},volume:{name:"volume",type:"float","default":1,min:0,max:1},pan:{name:"pan",type:"int","default":0,min:-100,max:100},audioNodes:{name:"audioNodes",type:"array",valueType:"audioNode"}},type:"audioRouter"}},type:{noteMap:{noteMap:{type:"noteMap",triggerIn:{name:"triggerIn",type:"string"},triggerOut:{name:"triggerOut",type:"string"},note:{name:"note",type:"string","default":"C4"},velocity:{name:"velocity",type:"int",min:0,max:127,"default":127},duration:{name:"duration",type:"int",min:0,max:9999999,"default":0}},type:"noteMap"},stateMap:{stateMap:{type:"stateMap","in":{name:"in",type:"list"},state:{name:"state",type:"string"}},type:"stateMap"},eventMap:{eventMap:{type:"eventMap","in":{name:"in",type:"list"},out:{name:"out",type:"string"},delay:{name:"delay",type:"int","default":0,max:1e4,min:0}},type:"eventMap"},file:{file:{type:{name:"type",type:"enum",values:["beatPattern","timePattern"],"default":""},name:{name:"name",type:"string"}},type:"file"},map:{map:{type:"map",inValue:{name:"inValue",type:"string"},outValue:{name:"outValue",type:"string"}},type:"map"},macroTarget:{target:{type:"macroTarget",targetId:{name:"targetId",type:"string"},min:{name:"min",type:"float","default":0,min:0,max:1},max:{name:"max",type:"float","default":1,min:0,max:1},targetType:{name:"targetType",type:"enum","default":"BUS",values:["SOUND","SYNTH","BUS"]},targetParameter:{name:"targetParameter",type:"string"}},type:"macroTarget"},sampleMapGroup:{sampleMapGroup:{type:"sampleMapGroup",name:{name:"name",type:"string"},sampleMaps:{name:"sampleMaps",type:"array",valueType:"sampleMap"}},type:"sampleMapGroup"},sampleMap:{sampleMap:{type:"sampleMap",name:{name:"name",type:"string"},velocityLow:{name:"velocityLow",type:"int","default":0,min:0,max:127},velocityHigh:{name:"velocityHigh",type:"int","default":127,min:0,max:127}},type:"sampleMap"},flowItem:{start:{type:"flowItem",delay:{name:"delay",type:"int","default":0,min:0,max:null},tempo:{name:"tempo",type:"float","default":120,min:40,max:280},beatsPerBar:{name:"beatsPerBar",type:"int","default":16,min:1,max:16},meter:{name:"meter",type:"list","default":["simple"],value:["simple","compound"]},subdivision:{name:"subdivision",type:"string","default":"16",values:["1","2D","2","2T","4D","4","4T","8D","8","8T","16D","16","16T","32D","32","32T"]}},type:"flowItem",stop:{type:"flowItem",songPosition:{name:"songPosition",type:"string","default":"NEXT_BEAT"},returnEvent:{name:"returnEvent",type:"string"}},beatEvent:{type:"flowItem",songPosition:{name:"songPosition",type:"string","default":"NEXT_BEAT"},returnEvent:{name:"returnEvent",type:"string"},output:{name:"output",type:"enum","default":"onEvent",values:["dispatch","onEvent"]}},add:{type:"flowItem",patternId:{name:"patternId",type:"string","default":"multi"},channel:{name:"channel",type:"string","default":"main"},songPosition:{name:"songPosition",type:"string","default":"NEXT_BAR"},patternPosition:{name:"patternPosition",type:"enum","default":"SYNC",values:["SYNC","FIRST_BEAT"]},clearPending:{name:"clearPending",type:"boolean","default":!0},replaceActive:{name:"replaceActive",type:"boolean","default":!0},setAsCurrent:{name:"setAsCurrent",type:"boolean","default":!0},loop:{name:"loop",type:"boolean","default":!1},loopLength:{name:"loopLength",type:"int","default":129,min:1,max:65536},clearPosition:{name:"clearPosition",type:"string","default":"NEXT_BAR"}}},band:{band:{type:"band",bandType:{name:"bandType",type:"enum","default":"PEAKING",values:["LOWPASS","HIGHPASS","BANDPASS","LOWSHELF","HIGHSHELF","PEAKING","NOTCH","ALLPASS"],automatable:!1},frequency:{name:"frequency",type:"float","default":800,min:20,max:22050,automatable:!0},Q:{name:"Q",type:"float","default":1,min:0,max:100,automatable:!0},gain:{name:"gain",type:"float","default":0,min:-40,max:40,automatable:!0}},type:"band"},audioNode:{chorus:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},feedback:{name:"feedback",type:"float","default":0,min:0,max:1,automatable:!1},delay:{name:"delay",type:"float","default":.0045,min:0,max:1,automatable:!1},rate:{name:"rate",type:"float","default":1.5,min:.01,max:8,automatable:!1},bypass:{name:"bypass",type:"float","default":0,min:0,max:1,automatable:!1}},type:"audioNode",overdrive:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},outputGain:{name:"outputGain",type:"float","default":0,min:0,max:1,automatable:!0},drive:{name:"drive",type:"float","default":0,min:0,max:1,automatable:!0},curveAmount:{name:"curveAmount",type:"float","default":1,min:0,max:1,automatable:!0},algorithmIndex:{name:"algorithmIndex",type:"int","default":0,min:0,max:5,automatable:!1}},compressor:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},threshold:{name:"threshold",type:"float","default":0,min:-100,max:0,automatable:!0},makeupGain:{name:"makeupGain",type:"float","default":1,min:0,max:100,automatable:!0},attack:{name:"attack",type:"float","default":1,min:0,max:1e3,automatable:!0},release:{name:"release",type:"float","default":1,min:0,max:3e3,automatable:!0},ratio:{name:"ratio",type:"float","default":4,min:1,max:20,automatable:!0},knee:{name:"knee",type:"float","default":5,min:0,max:40,automatable:!0},automakeup:{name:"automakeup",type:"boolean","default":!1}},cabinet:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},makeupGain:{name:"makeupGain",type:"float","default":1,min:0,max:20,automatable:!0},impulsePath:{name:"impulsePath",type:"string"}},filter:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},frequency:{name:"frequency",type:"float","default":20,min:20,max:22050,automatable:!0},Q:{name:"Q",type:"float","default":1,min:0,max:100,automatable:!0},gain:{name:"gain",type:"float","default":0,min:-40,max:40,automatable:!0},bypass:{name:"bypass",type:"boolean","default":!0,automatable:!0},filterType:{name:"filterType",type:"enum","default":"LOWPASS",values:["LOWPASS","HIGHPASS","BANDPASS","LOWSHELF","HIGHSHELF","PEAKING","NOTCH","ALLPASS"],automatable:!1}},convolver:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},highCut:{name:"highCut",type:"float","default":22050,min:20,max:22050,automatable:!0},lowCut:{name:"lowCut",type:"float","default":20,min:20,max:22050,automatable:!0},dryLevel:{name:"dryLevel",type:"float","default":1,min:0,max:1,automatable:!0},wetLevel:{name:"wetLevel",type:"float","default":1,min:0,max:1,automatable:!0},level:{name:"level",type:"float","default":1,min:0,max:1,automatable:!0},impulse:{name:"impulse",type:"string"}},delay:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},delayTime:{name:"delayTime",type:"float","default":30,min:.001,max:1e4,automatable:!1},feedback:{name:"feedback",type:"float","default":.45,min:0,max:.9,automatable:!0},cutoff:{name:"cutoff",type:"float","default":20,min:20,max:22050,automatable:!0},dryLevel:{name:"dryLevel",type:"float","default":1,min:0,max:1,automatable:!0},wetLevel:{name:"wetLevel",type:"float","default":1,min:0,max:1,automatable:!0},tempoSync:{name:"tempoSync",type:"string",automatable:!1},subdivision:{name:"subdivision",type:"enum","default":"8D",values:["1","2D","2","2T","4D","4","4T","8D","8","8T","16D","16","16T","32D","32","32T"],automatable:!1}},envelopeFollower:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},attackTime:{name:"attackTime",type:"float","default":.003,min:0,max:.5,automatable:!1},releaseTime:{name:"releaseTime",type:"float","default":.5,min:0,max:1,automatable:!1}},equalizer:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},bands:{name:"bands",type:"array",valueType:"band"}},lfo:{type:{name:"type",type:"enum","default":"SIN",values:["SIN","SQUARE","TRIANGLE","SAWTOOTH"],automatable:!1},active:{name:"active",type:"boolean","default":!0},frequency:{name:"frequency",type:"float","default":1,min:0,max:8,automatable:!1},offset:{name:"offset",type:"float","default":.85,min:0,max:22050,automatable:!1},phase:{name:"phase",type:"float","default":0,min:0,max:6.28318530718,automatable:!1},oscillation:{name:"oscillation",type:"float","default":.3,min:-22050,max:22050,automatable:!1}},phaser:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},rate:{name:"rate",type:"float","default":1,min:0,max:8,automatable:!1},depth:{name:"depth",type:"float","default":.3,min:0,max:1,automatable:!1},feedback:{name:"feedback",type:"float","default":.2,min:0,max:1,automatable:!1},stereoPhase:{name:"stereoPhase",type:"int","default":30,min:0,max:180,automatable:!1},baseModulationFrequency:{name:"baseModulationFrequency",type:"float","default":700,min:500,max:1500,automatable:!1}},pingPongDelay:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},delayTime:{name:"delayTime",type:"float","default":30,min:1e-4,max:1e4,automatable:!1},feedback:{name:"feedback",type:"float","default":.45,min:0,max:.9,automatable:!0},cutoff:{name:"cutoff",type:"float","default":20,min:20,max:22050,automatable:!0},dryLevel:{name:"dryLevel",type:"float","default":1,min:0,max:1,automatable:!0},wetLevel:{name:"wetLevel",type:"float","default":1,min:0,max:1,automatable:!0},tempoSync:{name:"tempoSync",type:"string",automatable:!1},subdivision:{name:"subdivision",type:"enum","default":"8D",values:["1","2D","2","2T","4D","4","4T","8D","8","8T","16D","16","16T","32D","32","32T"],automatable:!1}},tremolo:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},intensity:{name:"intensity",type:"float","default":.3,min:0,max:1,automatable:!1},stereoPhase:{name:"stereoPhase",type:"int","default":0,min:0,max:180,automatable:!1},rate:{name:"rate",type:"float","default":.1,min:.001,max:8,automatable:!1}},wahWah:{type:"audioNode",active:{name:"active",type:"boolean","default":!0},automode:{name:"automode",type:"boolean","default":!1},baseFrequency:{name:"baseFrequency",type:"float","default":.5,min:0,max:1,automatable:!1},excursionOctaves:{name:"excursionOctaves",type:"int","default":2,min:1,max:6,automatable:!1},sweep:{name:"sweep",type:"float","default":.2,min:0,max:1,automatable:!1},resonance:{name:"resonance",type:"float","default":10,min:1,max:100,automatable:!1},sensitivity:{name:"sensitivity",type:"float","default":.5,min:-1,max:1,automatable:!1}}}}},actions:[{type:"audioRouter",id:"AudioBus",triggers:["init_routing"],actionProperties:{instanceId:"master_bus",outputBus:"master",volume:.75,pan:0,audioNodes:[]},delay:0},{type:"parameterProcessor",id:"Transform",triggers:["sound_off","pause"],actionProperties:{instanceId:"master_mute",targetType:"audioRouter",targets:["master_bus"],targetParameter:"volume",value:0,duration:100,delay:0,curve:0},delay:0},{type:"parameterProcessor",id:"Transform",triggers:["sound_on","unpause"],actionProperties:{instanceId:"master_unmute",targetType:"audioRouter",targets:["master_bus"],targetParameter:"volume",value:.9,duration:100,delay:0,curve:0},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["init_routing"],actionProperties:{instanceId:"main",flowItems:[{id:"start",tempo:126,beatsPerBar:16}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["splash_screen"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"bass_filter__1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"dm_kraftwerk__1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"stab__1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"strings__1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_comp__1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_perc__1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_pop__1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["gameover_screen"],actionProperties:{instanceId:"main",flowItems:[{id:"start",delay:0,tempo:126,beatsPerBar:16},{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"bass__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"bass_comp__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"bass_filter__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"dm_kraftwerk__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"lead_a__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"lead_b__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"stab__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"strings__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_comp__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_perc__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_pop__2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["info_screen"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"bass_filter__12",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"stab__12",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_pop__12",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["fog_over","multiball_over","death_ball_over","mirrored_controls_over","timebomb_over","ghost_ball_over"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_comp__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_filter__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"dm_kraftwerk__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_comp__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_perc__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_pop__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"}]},delay:0},{type:"eventProcessor",id:"EventMapper",triggers:["countdown_init"],actionProperties:{instanceId:"handle_long",eventMaps:[{id:"eventMap","in":["countdown_init"],out:"countdown_long_start",delay:500},{id:"eventMap","in":["countdown_init"],out:"stop_immediate",delay:0}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["stop_immediate"],actionProperties:{instanceId:"main",flowItems:[{id:"stop",songPosition:"ASAP"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["countdown_long_start"],actionProperties:{instanceId:"main",flowItems:[{id:"start",delay:0,tempo:126,beatsPerBar:16},{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_comp__5",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"stab__5",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_perc__5",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_plucked__5",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_sharp__5",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"beatEvent",songPosition:"NEXT_BEAT+1.6",returnEvent:"gameplay_init",output:"onEvent"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["gameplay_init"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_comp__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_filter__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"dm_kraftwerk__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_comp__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_perc__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_pop__4",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"}]},delay:0},{type:"eventProcessor",id:"EventMapper",triggers:["countdown_short"],actionProperties:{instanceId:"handle_short",eventMaps:[{id:"eventMap","in":["countdown_short"],out:"countdown_short_start",delay:3500},{id:"eventMap","in":["countdown_short"],out:"gameplay_init",delay:3500}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["user_won_round","user_lost_round"],actionProperties:{instanceId:"main",flowItems:[{id:"stop",songPosition:"ASAP"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["countdown_short_start"],actionProperties:{instanceId:"main",flowItems:[{id:"start",tempo:126,beatsPerBar:16}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["fog_activate"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass__3",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_filter__3",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"dm_kraftwerk__3",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"stab__3",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_funk__3",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_perc__3",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_pop__3",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_sharp__3",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_warm__3",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["mirrored_controls_activate"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_comp__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_filter__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"dm_kraftwerk__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"lead_a__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"lead_b__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"stab__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_funk__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_plucked__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_sharp__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_warm__7",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["multiball_activate"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_comp__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_filter__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"dm_kraftwerk__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"stab__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_comp__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_funk__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_comp__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_plucked__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_pop__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_sharp__8",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["ghost_ball_activate"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass__9",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_comp__9",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_filter__9",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"dm_kraftwerk__9",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"stab__9",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_funk__9",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_plucked__9",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_pop__9",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_warm__9",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["timebomb_activate"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_filter__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"dm_kraftwerk__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"stab__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_comp__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_perc__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_plucked__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_pop__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_sharp__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_warm__10",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"}]},delay:0},{type:"player",id:"BeatPatternPlayer",triggers:["death_ball_activate"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"empty_pattern",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass__11",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"bass_filter__11",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"dm_kraftwerk__11",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"lead_a__11",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"},{id:"add",patternId:"synth_pop__11",channel:"main",songPosition:"NEXT_BEAT",patternPosition:"SYNC",clearPending:!1,replaceActive:!1,setAsCurrent:!1,loop:!0,loopLength:128,clearPosition:"NEXT_BEAT"}]},delay:0},{type:"customCode",id:"CustomCode",triggers:["init_routing","user_won_round","user_lost_round","user_won_match","user_lost_match"],actionProperties:{instanceId:"LevelTransposer"},delay:0},{type:"midiProcessor",id:"MidiProcessor",triggers:["item_up","item_down","paddle_fx","extra_life","winloose_tone","shield_hit","bass_filter","lead_a","lead_b","strings","synth_funk","synth_plucked","synth_sharp","synth_warm","bass","bass_comp","stab","synth_comp","synth_perc","synth_pop"],actionProperties:{instanceId:"midi_transposer",_dynamicValues:[{key:"transpose",string:"customCode:LevelTransposer:transposeValue"}],transpose:0,dynamic:0,quantize:"",scale:"",root:"",customScale:""},delay:0},{type:"sound",id:"GenericPlay",triggers:["user_won_round"],actionProperties:{delay:0,instanceId:"win_round_buzz",soundFile:"win_round_buzz",volume:0,loop:-1,reTrig:-1,returnEvent:"",returnEventTime:0,preListen:0,bus:"master_bus",timingCorrection:"PLAY",multiSuffix:"",pan:0,priority:!1},delay:0},{type:"sound",id:"GenericPlay",triggers:["user_lost_round"],actionProperties:{delay:0,instanceId:"loose_round_buzz",soundFile:"loose_round_buzz",volume:0,loop:-1,reTrig:-1,returnEvent:"",returnEventTime:0,preListen:0,bus:"master_bus",timingCorrection:"PLAY",multiSuffix:"",pan:0,priority:!1},delay:0},{type:"sound",id:"GenericPlay",triggers:["user_lost_round"],actionProperties:{delay:0,instanceId:"loose_fanfare",soundFile:"loose_fanfare",volume:0,loop:-1,reTrig:-1,returnEvent:"",returnEventTime:0,preListen:0,bus:"master_bus",timingCorrection:"PLAY",multiSuffix:"",pan:0,priority:!1},delay:0},{type:"sound",id:"GenericPlay",triggers:["user_won_round"],actionProperties:{delay:0,instanceId:"win_fanfare",soundFile:"win_fanfare",volume:0,loop:-1,reTrig:-1,returnEvent:"",returnEventTime:0,preListen:0,bus:"master_bus",timingCorrection:"PLAY",multiSuffix:"",pan:0,priority:!1},delay:0},{type:"sound",id:"GenericPlay",triggers:["opponent_screen_explode"],actionProperties:{delay:0,instanceId:"opponent_screen_break_between_levels",soundFile:"opponent_screen_break_between_levels",volume:0,loop:-1,reTrig:-1,returnEvent:"",returnEventTime:0,preListen:0,bus:"master_bus",timingCorrection:"PLAY",multiSuffix:"",pan:0,priority:!1},delay:0},{type:"midiProcessor",id:"MakeNote",triggers:["mirrored_controls_activate","mirrored_controls_spawn","fireball_activate","fireball_spawn","bulletproof_activate","bulletproof_spawn","multiball_activate","multiball_spawn","timebomb_activate","timebomb_spawn","ghost_ball_activate","ghost_ball_spawn","death_ball_activate","death_ball_spawn","extra_life_activate","user_paddle_hit","opponent_paddle_hit","wall_hit","obstacle_hit","user_shield_hit","opponent_shield_hit","opponent_score_hit","fog_spawn","fog_activate"],actionProperties:{instanceId:"makeFx",noteMaps:[{id:"noteMap",triggerIn:"extra_life_activate",triggerOut:"extra_life",note:"E1",velocity:127},{id:"noteMap",triggerIn:"user_paddle_hit",triggerOut:"paddle_fx",note:"E1",velocity:127},{id:"noteMap",triggerIn:"opponent_paddle_hit",triggerOut:"paddle_fx",note:"E2",velocity:127},{id:"noteMap",triggerIn:"wall_hit",triggerOut:"paddle_fx",note:"B2",velocity:127},{id:"noteMap",triggerIn:"obstacle_hit",triggerOut:"paddle_fx",note:"E3",velocity:127},{id:"noteMap",triggerIn:"opponent_shield_hit",triggerOut:"shield_hit",note:"E3",velocity:127},{id:"noteMap",triggerIn:"user_shield_hit",triggerOut:"shield_hit",note:"E3",velocity:127},{id:"noteMap",triggerIn:"opponent_score_hit",triggerOut:"winloose_tone",note:"E0",velocity:127},{id:"noteMap",triggerIn:"fog_spawn",triggerOut:"item_up",note:"E3",velocity:127},{id:"noteMap",triggerIn:"fog_activate",triggerOut:"item_down",note:"E3",velocity:127},{id:"noteMap",triggerIn:"extra_life_spawn",triggerOut:"item_up",note:"E3",velocity:127},{id:"noteMap",triggerIn:"death_ball_spawn",triggerOut:"item_up",note:"E3",velocity:127},{id:"noteMap",triggerIn:"death_ball_activate",triggerOut:"item_down",note:"E3",velocity:127},{id:"noteMap",triggerIn:"ghost_ball_spawn",triggerOut:"item_up",note:"E3",velocity:127},{id:"noteMap",triggerIn:"ghost_ball_activate",triggerOut:"item_down",note:"E3",velocity:127},{id:"noteMap",triggerIn:"timebomb_spawn",triggerOut:"item_up",note:"E3",velocity:127},{id:"noteMap",triggerIn:"timebomb_activate",triggerOut:"item_down",note:"E3",velocity:127},{id:"noteMap",triggerIn:"multiball_spawn",triggerOut:"item_up",note:"E3",velocity:127},{id:"noteMap",triggerIn:"multiball_activate",triggerOut:"item_down",note:"E3",velocity:127},{id:"noteMap",triggerIn:"bulletproof_spawn",triggerOut:"item_up",note:"E3",velocity:127},{id:"noteMap",triggerIn:"bulletproof_activate",triggerOut:"item_down",note:"E3",velocity:127},{id:"noteMap",triggerIn:"fireball_spawn",triggerOut:"item_up",note:"E3",velocity:127},{id:"noteMap",triggerIn:"fireball_activate",triggerOut:"item_down",note:"E3",velocity:127},{id:"noteMap",triggerIn:"mirrored_controls_spawn",triggerOut:"item_up",note:"E3",velocity:127},{id:"noteMap",triggerIn:"mirrored_controls_activate",triggerOut:"item_down",note:"E3",velocity:127}]},delay:0},{type:"synth",id:"Sampler",triggers:["paddle_fx"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:1,loop:!0,ampAttack:1,ampDecay:450,ampRelease:260,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"paddle_fx",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["extra_life"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:1,loop:!0,ampAttack:1,ampDecay:450,ampRelease:260,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"extralife",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["winloose_tone"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:1,loop:!0,ampAttack:1,ampDecay:450,ampRelease:260,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"winloose_tone",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["shield_hit"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:1,loop:!0,ampAttack:1,ampDecay:450,ampRelease:260,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"Shield_Hit",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["item_up"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:1,loop:!0,ampAttack:1,ampDecay:450,ampRelease:260,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"Item_Up",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["item_down"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:1,loop:!0,ampAttack:1,ampDecay:450,ampRelease:260,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"Item_Down",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"parameterProcessor",id:"Transform",triggers:["bass_filter_mute","lead_a_mute","lead_b_mute","strings_mute","synth_funk_mute","synth_plucked_mute","synth_sharp_mute","synth_warm_mute","dm_kraftwerk_mute","bass_mute","bass_comp_mute","stab_mute","synth_comp_mute","synth_perc_mute","synth_pop_mute"],actionProperties:{instanceId:"muteInst",targetType:"synth",targets:["multi"],targetParameter:"volume",multiSuffix:"_mute",value:-80,duration:100,delay:0,curve:0},delay:0},{type:"parameterProcessor",id:"Transform",triggers:["bass_filter_unmute","lead_a_unmute","lead_b_unmute","strings_unmute","synth_funk_unmute","synth_plucked_unmute","synth_sharp_unmute","synth_warm_unmute","dm_kraftwerk_unmute","bass_unmute","bass_comp_unmute","stab_unmute","synth_comp_unmute","synth_perc_unmute","synth_pop_unmute"],actionProperties:{instanceId:"unmuteInst",targetType:"synth",targets:["multi"],targetParameter:"volume",multiSuffix:"_unmute",value:-5,duration:100,delay:0,curve:0},delay:0},{type:"synth",id:"Sampler",triggers:["bass_filter"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:1,loop:!0,ampAttack:1,ampDecay:450,ampRelease:260,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"bass_filter_low",velocityLow:0,velocityHigh:50},{id:"sampleMap",name:"bass_filter_mid",velocityLow:51,velocityHigh:100},{id:"sampleMap",name:"bass_filter_hi",velocityLow:101,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["bass_comp"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-2,loop:!0,ampAttack:10,ampDecay:450,ampRelease:500,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["bass"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-2,loop:!0,ampAttack:1,ampDecay:1,ampRelease:220,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["stab"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-4,loop:!0,ampAttack:1,ampDecay:1,ampRelease:100,ampSustain:1,ampVelocityRatio:0,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["strings"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-6,loop:!0,ampAttack:1,ampDecay:1,ampRelease:220,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["synth_comp"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-3,loop:!0,ampAttack:1,ampDecay:1,ampRelease:1,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["synth_funk"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-5,loop:!0,ampAttack:1,ampDecay:200,ampRelease:300,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["synth_perc"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-13,loop:!0,ampAttack:1,ampDecay:1,ampRelease:1,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["synth_plucked"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:0,loop:!0,ampAttack:1,ampDecay:1,ampRelease:45,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["synth_pop"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-2,loop:!0,ampAttack:1,ampDecay:1,ampRelease:350,ampSustain:1,ampVelocityRatio:0,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["synth_sharp"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-7,loop:!0,ampAttack:1,ampDecay:1,ampRelease:100,ampSustain:1,ampVelocityRatio:0,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["synth_warm"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-13,loop:!0,ampAttack:1,ampDecay:1,ampRelease:500,ampSustain:1,ampVelocityRatio:0,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["lead_a"],actionProperties:{instanceId:"multi",ignoreNoteOff:!0,bus:"master_bus",volume:-8,loop:!0,ampAttack:1,ampDecay:350,ampRelease:500,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["lead_b"],actionProperties:{instanceId:"multi",ignoreNoteOff:!0,bus:"master_bus",volume:-9,loop:!0,ampAttack:1,ampDecay:100,ampRelease:500,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"synth",id:"Sampler",triggers:["dm_kraftwerk"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"master_bus",volume:-3,loop:!0,ampAttack:1,ampDecay:1,ampRelease:1,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"map1",sampleMaps:[{id:"sampleMap",name:"multi",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0},{type:"assetController",id:"LoadCustomCode",triggers:["preload_assets"],actionProperties:{instanceId:"transpose_loader",baseURL:"javascript/",returnEvent:"",files:[{id:"file",name:"transposer"}]},delay:0},{type:"assetController",id:"LoadMIDI",triggers:["preload_assets"],actionProperties:{instanceId:"midiLoader",baseURL:"midi/",returnEvent:"",files:[{id:"file",type:"beatPattern",name:"bass"},{id:"file",type:"beatPattern",name:"bass_comp"},{id:"file",type:"beatPattern",name:"bass_filter"},{id:"file",type:"beatPattern",name:"dm_kraftwerk"},{id:"file",type:"beatPattern",name:"lead_a"},{id:"file",type:"beatPattern",name:"lead_b"},{id:"file",type:"beatPattern",name:"stab"},{id:"file",type:"beatPattern",name:"strings"},{id:"file",type:"beatPattern",name:"synth_comp"},{id:"file",type:"beatPattern",name:"synth_funk"},{id:"file",type:"beatPattern",name:"synth_perc"},{id:"file",type:"beatPattern",name:"synth_plucked"},{id:"file",type:"beatPattern",name:"synth_pop"},{id:"file",type:"beatPattern",name:"synth_sharp"},{id:"file",type:"beatPattern",name:"synth_warm"},{id:"file",type:"beatPattern",name:"winloose_tone"}]},delay:0},{type:"assetController",id:"LoadSampleMap",triggers:["preload_assets"],actionProperties:{instanceId:"load_sampleMaps",baseURL:"xml/",returnEvent:"",files:[{id:"file",name:"samplemaps"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["dmaf_ready"],actionProperties:{instanceId:"load_fx",baseURL:"audio/fx/",returnEvent:"",files:[{id:"file",name:"Item_Up_E3"},{id:"file",name:"Item_Down_E3"},{id:"file",name:"PaddleFX_E0"},{id:"file",name:"PaddleFX_G0"},{id:"file",name:"PaddleFX_B0"},{id:"file",name:"PaddleFX_E1"},{id:"file",name:"PaddleFX_G1"},{id:"file",name:"PaddleFX_B1"},{id:"file",name:"PaddleFX_E2"},{id:"file",name:"PaddleFX_G2"},{id:"file",name:"PaddleFX_B2"},{id:"file",name:"PaddleFX_E3"},{id:"file",name:"PaddleFX_G3"},{id:"file",name:"PaddleFX_B3"},{id:"file",name:"ExtraLife_E1"},{id:"file",name:"ExtraLife_B1"},{id:"file",name:"ExtraLife_E2"},{id:"file",name:"Loose_Perc"},{id:"file",name:"Loose_E0"},{id:"file",name:"Loose_B0"},{id:"file",name:"Loose_E1"},{id:"file",name:"Loose_B1"},{id:"file",name:"Loose_E2"},{id:"file",name:"Loose_B2"},{id:"file",name:"Loose_E3"},{id:"file",name:"Loose_B3"},{id:"file",name:"Loose_E4"},{id:"file",name:"Loose_B4"},{id:"file",name:"Loose_E5"},{id:"file",name:"Loose_B5"},{id:"file",name:"Shield_Hit_E3"},{id:"file",name:"Shield_Hit_B3"},{id:"file",name:"Shield_Hit_E4"},{id:"file",name:"Shield_Hit_B4"},{id:"file",name:"loose_fanfare"},{id:"file",name:"loose_round_buzz"},{id:"file",name:"opponent_screen_break_between_levels"},{id:"file",name:"win_fanfare"},{id:"file",name:"win_round_buzz"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["dmaf_ready"],actionProperties:{instanceId:"load_bass_comp",baseURL:"audio/instruments/Bass_Comp/",returnEvent:"",files:[{id:"file",name:"Bass_Comp_E-1"},{id:"file",name:"Bass_Comp_As-1"},{id:"file",name:"Bass_Comp_E0"},{id:"file",name:"Bass_Comp_As0"},{id:"file",name:"Bass_Comp_E1"},{id:"file",name:"Bass_Comp_As1"},{id:"file",name:"Bass_Comp_E2"},{id:"file",name:"Bass_Comp_As2"},{id:"file",name:"Bass_Comp_E3"},{id:"file",name:"Bass_Comp_As3"},{id:"file",name:"Bass_Comp_E4"},{id:"file",name:"Bass_Comp_As4"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["preload_assets"],actionProperties:{instanceId:"load_bass",baseURL:"audio/instruments/Bass/",returnEvent:"",files:[{id:"file",name:"Bass_E0"},{id:"file",name:"Bass_As0"},{id:"file",name:"Bass_E1"},{id:"file",name:"Bass_As1"},{id:"file",name:"Bass_E2"},{id:"file",name:"Bass_As2"},{id:"file",name:"Bass_E3"},{id:"file",name:"Bass_As3"},{id:"file",name:"Bass_E4"},{id:"file",name:"Bass_As4"},{id:"file",name:"Bass_E5"},{id:"file",name:"Bass_As5"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["preload_assets"],actionProperties:{instanceId:"load_stab",baseURL:"audio/instruments/Stab/",returnEvent:"",files:[{id:"file",name:"Stab_E0"},{id:"file",name:"Stab_As0"},{id:"file",name:"Stab_E1"},{id:"file",name:"Stab_As1"},{id:"file",name:"Stab_E2"},{id:"file",name:"Stab_As2"},{id:"file",name:"Stab_E3"},{id:"file",name:"Stab_As3"},{id:"file",name:"Stab_E4"},{id:"file",name:"Stab_As4"},{id:"file",name:"Stab_E5"},{id:"file",name:"Stab_As5"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["preload_assets"],actionProperties:{instanceId:"load_kraftwerk",baseURL:"audio/instruments/DM_Kraftwerk/",returnEvent:"",files:[{id:"file",name:"KICK"},{id:"file",name:"SNARE"},{id:"file",name:"Hitt_2"},{id:"file",name:"hihat"},{id:"file",name:"Tapp_L"},{id:"file",name:"Tapp_R"},{id:"file",name:"Battery_1"},{id:"file",name:"Battery_2"},{id:"file",name:"Battery_3"},{id:"file",name:"Battery_4"},{id:"file",name:"Battery_5"},{id:"file",name:"Battery_6"},{id:"file",name:"Battery_7"},{id:"file",name:"Battery_8"},{id:"file",name:"Battery_9"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["preload_assets"],actionProperties:{instanceId:"load_synth_perc",baseURL:"audio/instruments/Synth_Perc/",returnEvent:"",files:[{id:"file",name:"Synth_Perc_E0"},{id:"file",name:"Synth_Perc_As0"},{id:"file",name:"Synth_Perc_E1"},{id:"file",name:"Synth_Perc_As1"},{id:"file",name:"Synth_Perc_E2"},{id:"file",name:"Synth_Perc_As2"},{id:"file",name:"Synth_Perc_E3"},{id:"file",name:"Synth_Perc_As3"},{id:"file",name:"Synth_Perc_E4"},{id:"file",name:"Synth_Perc_As4"},{id:"file",name:"Synth_Perc_E5"},{id:"file",name:"Synth_Perc_As5"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["preload_assets"],actionProperties:{instanceId:"load_synth_pop",baseURL:"audio/instruments/Synth_Pop/",returnEvent:"",files:[{id:"file",name:"Synth_Pop_E0"},{id:"file",name:"Synth_Pop_As0"},{id:"file",name:"Synth_Pop_E1"},{id:"file",name:"Synth_Pop_As1"},{id:"file",name:"Synth_Pop_E2"},{id:"file",name:"Synth_Pop_As2"},{id:"file",name:"Synth_Pop_E3"},{id:"file",name:"Synth_Pop_As3"},{id:"file",name:"Synth_Pop_E4"},{id:"file",name:"Synth_Pop_As4"},{id:"file",name:"Synth_Pop_E5"},{id:"file",name:"Synth_Pop_As5"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["preload_assets"],actionProperties:{instanceId:"load_synth_comp",baseURL:"audio/instruments/Synth_Comp/",returnEvent:"",files:[{id:"file",name:"Synth_Comp_E0"},{id:"file",name:"Synth_Comp_As0"},{id:"file",name:"Synth_Comp_E1"},{id:"file",name:"Synth_Comp_As1"},{id:"file",name:"Synth_Comp_E2"},{id:"file",name:"Synth_Comp_As2"},{id:"file",name:"Synth_Comp_E3"},{id:"file",name:"Synth_Comp_As3"},{id:"file",name:"Synth_Comp_E4"},{id:"file",name:"Synth_Comp_As4"},{id:"file",name:"Synth_Comp_E5"},{id:"file",name:"Synth_Comp_As5"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["preload_assets"],actionProperties:{instanceId:"load_strings",baseURL:"audio/instruments/Strings/",returnEvent:"",files:[{id:"file",name:"Strings_E-1"},{id:"file",name:"Strings_As-1"},{id:"file",name:"Strings_E0"},{id:"file",name:"Strings_As0"},{id:"file",name:"Strings_E1"},{id:"file",name:"Strings_As1"},{id:"file",name:"Strings_E2"},{id:"file",name:"Strings_As2"},{id:"file",name:"Strings_E3"},{id:"file",name:"Strings_As3"},{id:"file",name:"Strings_E4"},{id:"file",name:"Strings_As4"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["dmaf_ready"],actionProperties:{instanceId:"load_synth_plucked",baseURL:"audio/instruments/Synth_Plucked/",returnEvent:"",files:[{id:"file",name:"Synth_Plucked_E0"},{id:"file",name:"Synth_Plucked_As0"},{id:"file",name:"Synth_Plucked_E1"},{id:"file",name:"Synth_Plucked_As1"},{id:"file",name:"Synth_Plucked_E2"},{id:"file",name:"Synth_Plucked_As2"},{id:"file",name:"Synth_Plucked_E3"},{id:"file",name:"Synth_Plucked_As3"},{id:"file",name:"Synth_Plucked_E4"},{id:"file",name:"Synth_Plucked_As4"},{id:"file",name:"Synth_Plucked_E5"},{id:"file",name:"Synth_Plucked_As5"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["dmaf_ready"],actionProperties:{instanceId:"load_synth_sharp",baseURL:"audio/instruments/Synth_Sharp/",returnEvent:"",files:[{id:"file",name:"Synth_Sharp_E1"},{id:"file",name:"Synth_Sharp_As1"},{id:"file",name:"Synth_Sharp_E2"},{id:"file",name:"Synth_Sharp_As2"},{id:"file",name:"Synth_Sharp_E3"},{id:"file",name:"Synth_Sharp_As3"},{id:"file",name:"Synth_Sharp_E4"},{id:"file",name:"Synth_Sharp_As4"},{id:"file",name:"Synth_Sharp_E5"},{id:"file",name:"Synth_Sharp_As5"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["dmaf_ready"],actionProperties:{instanceId:"load_synth_funk",baseURL:"audio/instruments/Synth_Funk/",returnEvent:"",files:[{id:"file",name:"Synth_Funk_E0"},{id:"file",name:"Synth_Funk_As0"},{id:"file",name:"Synth_Funk_E1"},{id:"file",name:"Synth_Funk_As1"},{id:"file",name:"Synth_Funk_E2"},{id:"file",name:"Synth_Funk_As2"},{id:"file",name:"Synth_Funk_E3"},{id:"file",name:"Synth_Funk_As3"},{id:"file",name:"Synth_Funk_E4"},{id:"file",name:"Synth_Funk_As4"},{id:"file",name:"Synth_Funk_E5"},{id:"file",name:"Synth_Funk_As5"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["dmaf_ready"],actionProperties:{instanceId:"load_synth_warm",baseURL:"audio/instruments/Synth_Warm/",returnEvent:"",files:[{id:"file",name:"Synth_Warm_E0"},{id:"file",name:"Synth_Warm_As0"},{id:"file",name:"Synth_Warm_E1"},{id:"file",name:"Synth_Warm_As1"},{id:"file",name:"Synth_Warm_E2"},{id:"file",name:"Synth_Warm_As2"},{id:"file",name:"Synth_Warm_E3"},{id:"file",name:"Synth_Warm_As3"},{id:"file",name:"Synth_Warm_E4"},{id:"file",name:"Synth_Warm_As4"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["dmaf_ready"],actionProperties:{instanceId:"load_lead_a",baseURL:"audio/instruments/Lead_A/",returnEvent:"",files:[{id:"file",name:"Lead_A_E1"},{id:"file",name:"Lead_A_As1"},{id:"file",name:"Lead_A_E2"},{id:"file",name:"Lead_A_As2"},{id:"file",name:"Lead_A_E3"},{id:"file",name:"Lead_A_As3"},{id:"file",name:"Lead_A_E4"},{id:"file",name:"Lead_A_As4"},{id:"file",name:"Lead_A_E5"},{id:"file",name:"Lead_A_As5"},{id:"file",name:"Lead_A_E6"},{id:"file",name:"Lead_A_As6"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["dmaf_ready"],actionProperties:{instanceId:"load_lead_b",baseURL:"audio/instruments/Lead_B/",returnEvent:"",files:[{id:"file",name:"Lead_B_E1"},{id:"file",name:"Lead_B_As1"},{id:"file",name:"Lead_B_E2"},{id:"file",name:"Lead_B_As2"},{id:"file",name:"Lead_B_E3"},{id:"file",name:"Lead_B_As3"},{id:"file",name:"Lead_B_E4"},{id:"file",name:"Lead_B_As4"},{id:"file",name:"Lead_B_E5"},{id:"file",name:"Lead_B_As5"},{id:"file",name:"Lead_B_E6"},{id:"file",name:"Lead_B_As6"}]},delay:0},{type:"assetController",id:"LoadSound",triggers:["preload_assets"],actionProperties:{instanceId:"load_bass_filter",baseURL:"audio/instruments/Bass_Filter/",returnEvent:"",files:[{id:"file",name:"Bass_Filter_Low_E1"},{id:"file",name:"Bass_Filter_Low_As1"},{id:"file",name:"Bass_Filter_Low_E2"},{id:"file",name:"Bass_Filter_Low_As2"},{id:"file",name:"Bass_Filter_Low_E3"},{id:"file",name:"Bass_Filter_Low_As3"},{id:"file",name:"Bass_Filter_Low_E4"},{id:"file",name:"Bass_Filter_Low_As4"},{id:"file",name:"Bass_Filter_Low_E5"},{id:"file",name:"Bass_Filter_Low_As5"},{id:"file",name:"Bass_Filter_Low_E6"},{id:"file",name:"Bass_Filter_Low_As6"},{id:"file",name:"Bass_Filter_Low_E7"},{id:"file",name:"Bass_Filter_Low_As7"},{id:"file",name:"Bass_Filter_Mid_E1"},{id:"file",name:"Bass_Filter_Mid_As1"},{id:"file",name:"Bass_Filter_Mid_E2"},{id:"file",name:"Bass_Filter_Mid_As2"},{id:"file",name:"Bass_Filter_Mid_E3"},{id:"file",name:"Bass_Filter_Mid_As3"},{id:"file",name:"Bass_Filter_Mid_E4"},{id:"file",name:"Bass_Filter_Mid_As4"},{id:"file",name:"Bass_Filter_Mid_E5"},{id:"file",name:"Bass_Filter_Mid_As5"},{id:"file",name:"Bass_Filter_Mid_E6"},{id:"file",name:"Bass_Filter_Mid_As6"},{id:"file",name:"Bass_Filter_Mid_E7"},{id:"file",name:"Bass_Filter_Mid_As7"},{id:"file",name:"Bass_Filter_Hi_E1"},{id:"file",name:"Bass_Filter_Hi_As1"},{id:"file",name:"Bass_Filter_Hi_E2"},{id:"file",name:"Bass_Filter_Hi_As2"},{id:"file",name:"Bass_Filter_Hi_E3"},{id:"file",name:"Bass_Filter_Hi_As3"},{id:"file",name:"Bass_Filter_Hi_E4"},{id:"file",name:"Bass_Filter_Hi_As4"},{id:"file",name:"Bass_Filter_Hi_E5"},{id:"file",name:"Bass_Filter_Hi_As5"},{id:"file",name:"Bass_Filter_Hi_E6"},{id:"file",name:"Bass_Filter_Hi_As6"},{id:"file",name:"Bass_Filter_Hi_E7"},{id:"file",name:"Bass_Filter_Hi_As7"}]},delay:0}],formats:["ogg","aac","mp3","wav"],dependencies:["audioNode","beatPattern","iterator","assetController","audioRouter","customCode","eventProcessor","mediaElement","midiProcessor","parameterProcessor","player","sound","stateProcessor","synth"],dev:!1,build:{name:"chrome_pong",version:"0.1.0",dev:!1,root:"../verlet/views/","to-dmaf-root":"./javascript/dmaf/","deploy-to":"../verlet/public/javascript/",config:{read:"../verlet/public/xml/config.xml",write:"../verlet/public/javascript/dmaf.js"},immediate:!0,dependencies:["audioNode","beatPattern","iterator","assetController","audioRouter","customCode","eventProcessor","mediaElement","midiProcessor","parameterProcessor","player","sound","stateProcessor","synth"],formats:["ogg","aac","mp3","wav"]}}}),dmaf.once("load_core",function(t){function r(e){this.actionProperties=e.actionProperties,this.triggers=e.triggers,this.delay=e.delay||0,this.type=e.type,this.id=e.id,this.multi=this.actionProperties.instanceId==="multi"}var n=!1;t.ActionManager={triggers:{},addAction:function(e){var t;for(var n=0,r=e.triggers.length;n<r;n++)t=e.triggers[n],this.triggers[t]=this.triggers[t]||[],this.triggers[t].push(e),e.zindex=this.triggers[t].length},stop:function(){n=!0},onEvent:function(e,r,i){var s=this.triggers[e],o=r||t.context.currentTime*1e3,u;n=!1;if(!s||!s.length)return;for(var a=0,f=s.length;a<f;a++){u=s[a].delay?s[a].delay:0,s[a].execute(e,o+u,i);if(n)break}},createAction:function(e){if(!t[e.type]||!t[e.type][e.id]){console.log("DMAF Could not find module of type",e.type,"with id",e.id,"check the config.xml to make sure you've included this module.");return}this.addAction(new r(e))}},r.prototype={execute:function(e,n,r){var i,s,o;s=this.multi?e:this.actionProperties.instanceId,i=t.getInstance(this.type,s||"no_instance_id"),i?i._dynamicValues&&i.setDynamicValues():(o=t.Utils.clone(this.actionProperties),o.instanceId=s,o.type=this.type,o.id=this.id,i=t[this.type][this.id].createInstance(o)),i.onAction(e,n,r,this.actionProperties)}}}),dmaf.once("load_core",function(e){function m(){var t=0;l=v.currentTime*1e3;if(!o.length&&!s.length){u=!1;return}for(;t<o.length;t++)o[t].callback.call(o[t].context);for(t=0;t<s.length;t++)s[t]&&l>s[t].actionTime-e.preListen&&(s[t].callback.apply(s[t].context,s[t].args),s[t].pending.splice(s[t].pendingId,1),s.splice(t--,1));u=!0,e.lastTime=e.currentTime,e.currentTime=e.context.currentTime,e.lastTime===e.currentTime&&console.error("Dirty context time!"),setTimeout(m,20)}function g(e){var t=o.length;while(t--)if(o[t].id===e)return!0;return!1}var t=e.Clock=Object.create(null),n=Array.prototype.slice,r=!1,i=[],s=[],o=[],u=!1,a=0,f,l,c,h,p,d,v=e.context;e.preListen=60,e.lastTime=0,e.currentTime=-1,t.checkFunctionTime=function(t,r,i,o){if(t>=e.context.currentTime*1e3+e.preListen){var f={pendingId:i.length,pending:i,callback:r,actionTime:t,context:o||e,args:n.call(arguments,4),id:a++};i.push(f.id),s.push(f),u||(u=!0,m())}else r.apply(o,n.call(arguments,4))},t.dropPendingArray=function(e){var t=s.length,n;while(t--)s[t].pending===e&&(s.splice(t,1),e.length=0)},t.addFrameListener=function(t,n,r){if(g(t)){console.log("That frame listener is already running!",t);return}o.push({callback:n,context:r||e,id:t}),u||(u=!0,m())},t.removeFrameListener=function(e){var t=o.length;while(t--)if(o[t].id===e)return o.splice(t,1),!0;return!1}}),dmaf.once("load_framework",function(t){function i(){var e=t.context.createBufferSource(),n=t.context.createBuffer(1,100,44100);e.buffer=n,e.noteOn(0)}function s(){t.dispatch("kick_note"),document.removeEventListener("touchstart",s,!1)}function a(e){e===100&&(dmaf.removeEventListener("progress_event",a),t.ActionManager.onEvent("init_routing"),t.ActionManager.onEvent("dmaf_ready"),dmaf.active=!0,console.log("dispatching dmaf_ready"),t.dispatch("dmaf_ready"))}var n=window.AudioContext||window.webkitAudioContext,r;if(!n)return t.failure();t.context=new n,dmaf.addEventListener("kick_note",i),document.addEventListener("touchstart",s,!1),t.dispatch("kick_note"),t.dispatch("load_core",t),t.Utils.getFileFormat(t.Settings.formats);for(var o=0,u=t.Settings.dependencies.length;o<u;o++)t.dispatch("load_"+t.Settings.dependencies[o],t);for(o=0,u=t.Settings.actions.length;o<u;o++)t.ActionManager.createAction(t.Settings.actions[o]);r=t.ActionManager.triggers.preload_assets,r&&r.length?(dmaf.addEventListener("progress_event",a),t.ActionManager.onEvent("preload_assets")):a(100)}),dmaf.addEventListener("load_core",function(e){function n(e,t){this.activeInstances=Object.create(null),this.constructor=e,this.isManaged=!t}function r(n){return function(r){var i,s;return t.test(r)?(i=r.split(t),i.length>2&&(s=i.slice(2),i.length=2,i.push(s))):i=arguments,i[0]?e[i[0]]?n.apply(e,i):(console.log("Invalid type!",i[0]),null):(console.log("Missing arguments!"),null)}}var t=/[:]/;e.registerInstance=function(t,r,i,s){e[t]=e[t]||Object.create(null),e[t].ids=e[t].ids||[],e[t].ids.push(r);var o=r.charAt(0).toLowerCase()+r.slice(1);i.prototype.defaults=e.Settings.descriptors.action[t][o]||{},e[t][r]=new n(i,s)},e.getInstance=function(t,n){var r,i,s,o=0;r=e[t].ids;for(;i=r[o++];){s=this[t][i].getInstance(n);if(s)return s}return null},e.getInstance=r(e.getInstance),e.getInstanceProperty=function(t,n,r){var i=e.getInstance(t,n);if(!i)return console.log("missing instance",t,n),null;property=i;for(var s=0,o=r.length;s<o;s++){if(typeof property=="undefined"||typeof property!="object"&&typeof property!="function")break;property=property[r[s]]}return s!==o?(console.log("Could not find property."),null):property},e.getInstanceProperty=r(e.getInstanceProperty),e.addInstance=function(t){if(!this.InstancePrototype.isPrototypeOf(t)){console.log("DMAF.addInstance may only be used with DMAF instances"),console.trace();return}e[t.type][t.id].addInstance(t)},e.removeInstance=function(e,t){var n=this.getInstance(e,t);return n?this[n.type][n.id].removeInstance(t):(console.log("DMAF.remove: Could not find instance",e,t),!1)},e.removeInstance=r(e.removeInstance),e.InstancePrototype={audioParam:function(){var t=e.context.createGainNode().gain;return Object.getPrototypeOf(t.constructor.prototype)}(),setInitProperties:function(e){var t=Object.keys(e),n,r=0;for(;n=t[r++];)this[n]=e[n];return this.setDynamicValues(),this},init:function(){return this},onAction:function(){return this},returnChildInstance:function(n){var r,i,s,o,u;if(t.test(n)){r=n.split(t);if(r.length&&r.length>1){u=this;for(s=0,o=r.length;s<o;s++){i=r[s],u=u[i];if(typeof u!="object")return{instance:this,ref:n};if(e.InstancePrototype.isPrototypeOf(u))return r=r.slice(s+1).join(":"),u.returnChildInstance(r)}}}return{instance:this,ref:n}},setProperty:function(n,r,i,s){var o,u,a,f,l,c,h,p,d=this.returnChildInstance(n);if(d.instance!==this)return d.instance.setProperty(d.ref,r,i,s);if(t.test(n)){console.log("DMAF Does not support colon syntax for properties within arrays.");return}if(this[n]===undefined){console.log(n,"is not a valid property for instance type",this.id);return}r=this.verify(n,r),this.audioParam.isPrototypeOf(this[n])?(s<e.context.currentTime*1e3&&(s=e.context.currentTime*1e3),s=s?s/1e3:e.context.currentTime,i=i=i?i/1e3:0,i?p="linearRampToValueAtTime":p="setValueAtTime",this[n].cancelScheduledValues(s),this[n].setValueAtTime(this[n].value,s),this[n][p](r,i+s)):this[n]=r},setDynamicValues:function(){var t=this._dynamicValues,n,r,i;if(!t)return;for(var s=0,o=t.length;s<o;s++)r=t[s].string||"string_not_defined",n=t[s].key,i=e.getInstanceProperty(r),this[n]=this.verify(n,i);return this},verify:function(e,t,n){var r,i,s;r=n?n:this.defaults[e],i=!!r,i=t===undefined;switch(r.type){case"int":i=parseFloat(t)!==parseInt(t,10),t=parseInt(t,10),i=isNaN(t),i=!isFinite(t),i=typeof t!="number",t<r.min&&(t=r.min),t>r.max&&(t=r.max);break;case"float":i=isNaN(parseFloat(t)),i=!isFinite(t),i=typeof t!="number",t=parseFloat(t),t<r.min&&(t=r.min),t>r.max&&(t=r.max);break;case"string":i=typeof t!="string";break;case"list":i=!(t instanceof Array);break;case"enum":i=r.value.indexOf(t)===-1;break;case"array":console.log("Array type found in verify",e,t,n);break;case"boolean":i=typeof t!="boolean"}return i?(console.log("DMAF Verification error",e,t,this),r["default"]):t}},e.setValueAtTime=function(t,n,r,i){e.Clock.checkFunctionTime(i,function(){t[n]=r},[],e)},n.prototype={getInstance:function(e){return this.activeInstances[e]},removeInstance:function(e){return delete this.activeInstances[e]},addInstance:function(e){this.activeInstances[e.instanceId]=e},createInstance:function(t){var n=new this.constructor(t);return n.setInitProperties(t).init(t),this.isManaged&&e.addInstance(n),n}}}),dmaf.once("load_core",function(e){function o(t){if(!t){console.log("Problem parsing XML",arguments);return}var n=t.querySelectorAll("samplemap"),r=["sound","root","low","hi","vol"],i,s,o,u,a,f,l,c,h,p;for(i=0,s=n.length;i<s;i++){l=n[i],h=l.getAttribute("name"),c=l.querySelectorAll("range"),p={};for(o=0,u=c.length;o<u;o++)p["range_"+o]={sound:c[o].getAttribute("sound"),root:c[o].getAttribute("root"),low:c[o].getAttribute("low"),hi:c[o].getAttribute("hi"),vol:parseFloat(c[o].getAttribute("vol"))};e.setAsset("sampleMap",h,p)}}function u(e,t,n){var r=new l(e);switch(t){case"beatPattern":h(r,n);break;case"timePattern":c(r,n);break;default:h(r,n)}}function a(e,t,n){this.absoluteTime=t+e.readVariableLengthInt();var r=e.read8BitInt();(r&240)==240?this.getMetaEvent(e,r):this.getChannelEvent(e,r,n)}function f(e){this.pointer=0,this.midiString=e}function l(e){f.call(this,e.split("").map(d).join("")),this.tracks=[],this.chunk={},this.lastEventType=0,this.getNextChunk("MThd").readHeader().getTracks()}function c(t,n){var r,i,s,o,u,a,f,l,c,h,d,v,m;for(f=0,l=t.trackCount;f<l;f++){o=t.tracks[f],r=o[0].text||n+f+"",trigger=o[1].text||n+f+"",s=[];for(c=0,h=o.length;c<h;c++)if(o[c].subtype==="setTempo"){m=6e7/o[c].microsecondsPerBeat;break}for(c=0,h=o.length;c<h;c++)if(o[c].subtype==="noteOn"){u=o[c],u.type=u.subtype,u.trigger=trigger;for(d=c;d<h;d++)if(p(o[d],u))break;u.absoluteTime=u.absoluteTime*6e4/(t.ticksPerBeat*m)+1,u.duration=u.duration*6e4/(t.ticksPerBeat*m),s.push(u)}i=new e.Processor.TimePattern(r,s),e.setAsset("timePattern",r,i)}}function h(t,n){var r,i,s,o,u,a,f,l,c,h,d,v,m;for(f=1,l=t.trackCount;f<l;f++){u=t.tracks[f],r=u[0].text||n+f+"",s=u[1].text||n+f+"",o=new e.Processor.BeatPattern(r,1);for(c=2,h=u.length;c<h;c++)if(u[c].subtype==="noteOn"){a=u[c],a.type=a.subtype,d=Math.floor(a.absoluteTime/t.beatLengthInTicks),v=Math.floor(a.absoluteTime-d*t.beatLengthInTicks);for(m=c;m<h;m++)if(p(u[m],a))break;o.addEvent(s,d+1,v+1,a)}e.setAsset("beatPattern",r,o)}}function p(e,t){var n=(e.subtype==="noteOn"||e.subtype==="noteOff")&&e.subtype;if(!n||e.midiNote!==t.midiNote)return!1;if(n==="noteOn"&&!e.velocity||n==="noteOff")return t.duration=e.absoluteTime-t.absoluteTime}function d(e){return String.fromCharCode(e.charCodeAt(0)&255)}var t=["int","float","string","boolean","list","array","enum"],n="getAttribute",r={automatable:"boolean","default":"fromType",valueType:"string",loadEvent:"string",value:"fromType",min:"fromType",max:"fromType",name:"string",type:"string",values:"list",unit:"string",src:"string"},i=/[\,]/;e.parse=function(t){var n=Array.prototype.slice.call(arguments,1);return s[t]?s[t].apply(e,n):(console.log("DMAF.parse: invalid type",t),null)};var s={midi:u,samplemap:o};a.prototype={getMetaEvent:function(e,t){var n,r;if(t==255){this.type="meta",r=e.read8BitInt(),n=e.readVariableLengthInt();switch(r){case 0:this.subtype="sequenceNumber";if(n!=2)return;this.number=e.read16BitInt();return;case 1:this.subtype="text",this.text=e.readTo(n);return;case 2:this.subtype="copyrightNotice",this.text=e.readTo(n);return;case 3:this.subtype="trackName",this.text=e.readTo(n);return;case 4:this.subtype="instrumentName",this.text=e.readTo(n);return;case 5:this.subtype="lyrics",this.text=e.readTo(n);return;case 6:this.subtype="marker",this.text=e.readTo(n);return;case 7:this.subtype="cuePoint",this.text=e.readTo(n);return;case 32:this.subtype="midiChannelPrefix";if(n!==1)return;this.channel=e.read8BitInt();return;case 47:this.subtype="endOfTrack";if(n!==0)return;return;case 81:this.subtype="setTempo";if(n!=3)return;this.microsecondsPerBeat=(e.read8BitInt()<<16)+(e.read8BitInt()<<8)+e.read8BitInt();return;case 84:this.subtype="smpteOffset";if(n!=5)return;var i=e.read8BitInt();this.frameRate={0:24,32:25,64:29,96:30}[i&96],this.hour=i&31,this.min=e.read8BitInt(),this.sec=e.read8BitInt(),this.frame=e.read8BitInt(),this.subframe=e.read8BitInt();return;case 88:this.subtype="timeSignature";if(n!==4)return;this.numerator=e.read8BitInt(),this.denominator=Math.pow(2,e.read8BitInt()),this.metronome=e.read8BitInt(),this.thirtyseconds=e.read8BitInt();return;case 89:this.subtype="keySignature";if(n!==2)return;this.key=e.read8BitInt(),this.scale=e.read8BitInt();return;case 127:this.subtype="sequencerSpecific",this.data=e.readTo(n);return;default:this.subtype="unknown",this.data=e.readTo(n);return}this.data=e.readTo(n);return}if(t==240){this.type="sysEx",n=e.readVariableLengthInt(),this.data=e.readTo(n);return}if(t==247){this.type="dividedSysEx",n=e.readVariableLengthInt(),this.data=e.readTo(n);return}this.type="unknown",n=e.readVariableLengthInt(),this.data=e.readTo(n),console.error("unknown MIDI event type byte of length"+n)},getChannelEvent:function(e,t,n){var r,i;(t&128)===0?(i=t,t=n.lastEventType):(i=e.read8BitInt(),n.lastEventType=t),r=t>>4,this.channel=t&15,this.type="channel";switch(r){case 8:this.subtype="noteOff",this.midiNote=i,this.velocity=e.read8BitInt();break;case 9:this.midiNote=i,this.velocity=e.read8BitInt(),this.velocity===0?this.subtype="noteOff":this.subtype="noteOn";break;case 10:this.subtype="noteAftertouch",this.midiNote=i,this.amount=e.read8BitInt();break;case 11:this.subtype="controller",this.controllerType=i,this.value=e.read8BitInt();break;case 12:this.subtype="programChange",this.programNumber=i;break;case 13:this.subtype="channelAftertouch",this.amount=i;break;case 14:this.subtype="pitchBend",this.value=i+(e.read8BitInt()<<7);break;default:this.subtype="unknown",console.error("Unrecognised MIDI event type: "+r)}}},f.prototype={read32BitInt:function(){var e=(this.midiString.charCodeAt(this.pointer)<<24)+(this.midiString.charCodeAt(this.pointer+1)<<16)+(this.midiString.charCodeAt(this.pointer+2)<<8)+this.midiString.charCodeAt(this.pointer+3);return this.pointer+=4,e},read16BitInt:function(){var e=(this.midiString.charCodeAt(this.pointer)<<8)+this.midiString.charCodeAt(this.pointer+1);return this.pointer+=2,e},read8BitInt:function(){var e=this.midiString.charCodeAt(this.pointer);return this.pointer+=1,e},readTo:function(e){var t=this.midiString.substr(this.pointer,e);return this.pointer+=e,t},endOfFile:function(){return this.pointer>=this.midiString.length},readVariableLengthInt:function(){var e=0;for(;;){var t=this.read8BitInt();if(!(t&128))return e+t;e+=t&127,e<<=7}}},l.prototype=Object.create(f.prototype,{readHeader:{value:function(){var e=new f(this.chunk.data);return this.formatType=e.read16BitInt(),this.trackCount=e.read16BitInt(),this.ticksPerBeat=e.read16BitInt(),this.ticksPerBeat&32768&&(this.ticksPerBeat=480,console.log("Time division in SMPTE, defaulting to 480 ticks per beat")),this.beatLengthInTicks=this.ticksPerBeat/4,this}},getTracks:{value:function(){var e,t,n;for(var r=0,i=this.trackCount;r<i;r++){this.tracks[r]=[],t=0,this.getNextChunk("MTrk"),e=new f(this.chunk.data);while(!e.endOfFile())n=new a(e,t,this),this.tracks[r].push(n),t=n.absoluteTime}return this}},getNextChunk:{value:function(e){this.chunk.id=this.readTo(4),this.chunk.length=this.read32BitInt(),this.chunk.data=this.readTo(this.chunk.length);if(this.chunk.id!==e)throw new Error("MidiParser expected",e,"but found",this.chunk.id);return this}}})}),dmaf.addEventListener("load_core",function(t){function a(e,t){return console.log("DMAF TypeError for "+t.name+": "+e+" is not of type "+t.type),t["default"]}function f(e,t){return console.log("DMAF RangeError for "+t.name+": "+e+" is below minimum threshold."),t.min}function l(e,t){return console.log("DMAF RangeError for "+t.name+": "+e+" is above maximum threshold."),t.max}function c(e,t){return console.log("DMAF enumError for "+t.name+": "+e+" is not an allowed value"),t["default"]}var n="int",r="float",i="string",s="boolean",o=0,u={cflat:-1,c:0,csharp:1,dflat:1,d:2,dsharp:3,eflat:3,e:4,esharp:5,fflat:4,f:5,fsharp:6,gflat:6,g:7,gsharp:8,aflat:8,a:9,asharp:10,bflat:10,b:11,bsharp:12};t.Utils={ajax:function(e,n,r){function a(){if(this.readyState===4){var n=r&&r.context||t,a,f=this.status>=200&&this.status<300||this.status===304;if(!f||!this.response)return i.onerror=function(){},u();if(r&&r.expectType&&typeof this.response!==r.expectType)return u();a=r.responseXML?this.responseXML:this.response;if(r.responseXML&&!this.responseXML)return console.log("Problem with XMLHttpRequest: XML is missing or malformed.",e),u();for(var l=0,c=o.length;l<c;l++)s.unshift(a),a=o[l].apply(n,s)}}var i=new XMLHttpRequest,s=[],o=[n],u;r?(r.override&&i.overrideMimeType(r.override),r.responseType&&(i.responseType=r.responseType),r.chain&&(o=o.concat(r.chain)),r.args&&(s=s.concat(r.args))):r={},u=r.fail?r.fail:function(n){console.log("DMAF.ajax: Problem with request",e)},i.onerror=u,i.onreadystatechange=a,i.open("GET",e,!0),i.send()},clone:function(e){return typeof e!="object"?{}:JSON.parse(JSON.stringify(e))},calculateAverage:function(e){var t=0,n=0,r=e.length;for(;n<r;n++)t+=e[n];return t/e.length},dbToJSVolume:function(e){var t=Math.max(0,Math.round(100*Math.pow(2,e/6))/100);return Math.min(1,t)},dbToWAVolume:function(e){return Math.max(0,Math.round(100*Math.pow(2,e/6))/100)},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},createEffectsRecursive:function(e,n){var r=[],i,s;for(var o=0;o<n.length;o++)i=n[o],s=new(t.AudioNodes[this.capitalize(i.id)])(i),i.active?s.activate(!0):s.activate(!1),r.push(s),e.connect(s.input),e=s;return r},fromString:function(e,t){if(t==="undefined")return undefined;switch(e){case"string":return t;case"boolean":return t==="true";case"int":return parseInt(t,10);case"float":return parseFloat(t);case"list":return t.split(separator);default:console.error("FromString Error: ",e,t)}},MIDIToFrequency:function(e){return 8.1757989156*Math.pow(2,e/12)},removeWhiteSpace:function(e){return e.replace(/\s+/g,"")},toMIDINote:function(e){var t,n,r,i,s;return e[1]==="#"||e[1].toLowerCase()==="s"?(n=e[0].toLowerCase()+"sharp",s=2):e[1]==="b"?(n=e[0].toLowerCase()+"flat",s=2):(n=e[0].toLowerCase(),s=1),n=u[n],e[s]==="-"?i=(0-parseInt(e[s+1],10)+2)*12:i=(parseInt(e[s],10)+2)*12,t=i+n,t},getFileFormat:function(e){function i(e){return!!n.canPlayType&&!!n.canPlayType(r[e]||"").replace(/no/,"")}var n=document.createElement("audio"),r={wav:'audio/wav; codecs="1"',mp3:"audio/mpeg;",aac:'audio/mp4; codecs="mp4a.40.2"',ogg:'audio/ogg; codecs="vorbis"'};for(var s=0,o=e.length;s<o;s++)if(i(e[s])){t.fileFormat="."+e[s];return}console.error("Couldn't play any of the wanted file formats!"),t.fileFormat=null},verify:function(e,t,n){var r;typeof e=="string"&&(e=this.defaults[e]);if(t===undefined)return e["default"];e.type===undefined&&console.error("DMAF Verification Error: Malformed defaults object.");switch(e.type){case"int":parseFloat(t)!==parseInt(t,10)&&(r=a),isNaN(t)&&(r=a),t<e.min&&(r=f),t>e.max&&(r=l);break;case"float":isNaN(t)&&(r=a),t<e.min&&(r=f),t>e.max&&(r=l);break;case"string":typeof t!="string"&&(r=a);break;case"list":t instanceof Array||(r=a);break;case"enum":if(e.values){if(e.values.indexOf(t)!==-1)break;r=c}else console.error("DMAF Verification Error! Missing values list for enum type value."),r=!0;break;case"boolean":typeof t!="boolean"&&(r=a);break;default:console.error("DMAF Verification Error! Malformed defaults object. Please check the descriptors.xml")}return r?(r(t,e),e["default"]):t}}}),dmaf.once("load_assetController",function(e){function s(){}function o(){}function u(){}function a(){}function f(e){return e.name}function l(e){console.error("DMAF error Loading Asset ",e)}var t="assetController",n=Object.create(e.InstancePrototype,{init:{value:function(){this.loadCount=0}},onload:{value:function(){this.returnEvent&&e.dispatch(this.returnEvent),e[this.type][this.id].removeInstance(this.instanceId)}},onstep:{value:function(){var t=100-Math.floor(--r.loadsInProgress/r.loadTotals[this.task]*100);t!==r.loadPercents[this.task]&&(e.dispatch("progress_event",t,this.fileNames[this.loadCount]+this.format),r.loadPercents[this.task]=t),++this.loadCount===this.fileNames.length&&this.onload()}},onAction:{value:function(e){if(this.inProgress)return;r.listenForLoads(e),this.task=e,this.fileNames=this.files.map(f),r.loadsInProgress+=this.fileNames.length,this.inProgress=!0;for(var t=0,n=this.fileNames.length;t<n;t++)this.loadFile(this.baseURL+this.fileNames[t]+this.format,this.fileNames[t],t)}}}),r={beatPattern:{},sampleMap:{},buffer:{},timePattern:{},loadsInProgress:0,loadTotals:{},loadPercents:{},listenForLoads:function(n){if(this.loadTotals[n]!==undefined)return;var r=e.ActionManager.triggers[n];if(!r.length)return;r=r.slice(0).filter(function(e){return e.type=t}),this.loadTotals[n]=0,this.loadPercents[n]=0;for(i=0,ii=r.length;i<ii;i++)this.loadTotals[n]+=r[i].actionProperties.files.length}};e.getAsset=function(e,t){return r[e]&&r[e][t]?r[e][t]:(console.log("DMAF.getAsset: Couldn't find asset",e,t),null)},e.setAsset=function(e,t,n){r[e]=r[e]||{},r[e][t]=n},e.Processor&&(r.beatPattern.empty_pattern=new e.Processor.BeatPattern("empty_pattern",1)),s.prototype=Object.create(n,{format:{value:".js"},loadFile:{value:function(t,n,r){var i=this,s=document.createElement("script");s.type="text/javascript",s.src=t,s.addEventListener("load",function(){e.dispatch("load_custom",e),i.onstep(),s.remove!==undefined&&s.remove()}),document.body.appendChild(s)}}}),e.registerInstance(t,"LoadCustomCode",s),o.prototype=Object.create(n,{format:{value:".xml"},loadFile:{value:function(t,n,r){function s(t){e.parse("samplemap",t)}var i={chain:[this.onstep],context:this,responseXML:!0,fail:function(){console.log("Problem parsing samplemap file"),this.onstep()}};e.Utils.ajax(t,s,i)}}}),e.registerInstance(t,"LoadSampleMap",o),u.prototype=Object.create(n,{format:{value:".mid"},loadFile:{value:function(t,n,r){function s(t){e.parse("midi",t,this.files[r].type,n),this.onstep()}var i={override:"text/plain; charset=x-user-defined",expectType:"string",context:this,fail:function(){console.log("Problem parsing midi file",t),this.onstep()}.bind(this)};e.Utils.ajax(t,s,i)}}}),e.registerInstance(t,"LoadMIDI",u),a.prototype=Object.create(n,{loadFile:{value:function(t,n){function a(t){u>0&&console.log("Retry success",n),e.context.decodeAudioData(t,s,o)}function f(){++u<3?(console.log("Could not load audio file",n,"trying again."),e.Utils.ajax(t,a,i,"buffer")):(console.log("Could not load audio file",n),this.onstep())}var i={responseType:"arraybuffer",fail:f.bind(this)},s=function(e){r.buffer[n]=e,this.onstep()}.bind(this),o=function(e){console.log("Could not decode file",n,e),this.onstep()}.bind(this),u=0;e.Utils.ajax(t,a,i,"buffer")}},format:{value:e.fileFormat}}),e.registerInstance(t,"LoadSound",a)}),dmaf.once("load_audioRouter",function(e){function r(){this.input=e.context.createGainNode(),this.output=e.context.createGainNode()}var t="audioRouter",n=e.InstancePrototype;r.prototype=Object.create(n,{init:{value:function(n){var r=this.input;this.effects=e.Utils.createEffectsRecursive(this.input,n.audioNodes),this.effects.length>0&&(r=this.effects[this.effects.length-1]),r.connect(this.output);if(this.outputBus==="master")this.output.connect(e.context.destination);else{var i=e.getInstance(t,this.outputBus);this.output.connect(i?i.input:e.context.destination)}}},volume:{get:function(){return this.output.gain},set:function(e){this.output.gain.value=e}},getAutomatableProperties:{value:function(e){if(e.substring(0,2)=="fx")return this.effects[parseInt(e.substring(2),10)]}},setAutomatableProperty:{value:function(t,n,r,i){var s=r>0?"linearRampToValueAtTime":"setValueAtAtTime";switch(t){case"volume":n=parseFloat(n),t="gain";break;case"pan":break;default:return}console.log("setAutomatableProperty>>>>>>>>>>>>>"),this.output[t].cancelScheduledValues(e.context.currentTime),this.output[t].setValueAtTime(this.output[t].value,e.context.currentTime),this.output[t][s](n,(i+r)/1e3)}},onAction:{value:function(){}}}),e.registerInstance(t,"AudioBus",r)}),dmaf.once("load_customCode",function(t){function i(){}function s(){}var n="customCode",r=t.InstancePrototype;i.prototype=Object.create(r),t.registerInstance("customCode","CustomCode",i),t.customCode.CustomCode.createInstance=function(e){if(t.customCode[e.instanceId]){var n=t.customCode[e.instanceId].createInstance(e);return n}console.log(e.instanceId,"was not registered with DMAF")},s.prototype=Object.create(r,{onAction:{value:function(e,n,r,i){var s=t.pendingObjects[this.instanceId];instance&&(this.obj=s)}}}),t.registerInstance("customCode","UserObject",s)}),dmaf.once("load_eventProcessor",function(e){function r(){}function i(){}var t="eventProcessor",n=e.InstancePrototype;r.prototype=Object.create(n,{onAction:{value:function(t,n,r,i){var s;for(var o=0,u=this.eventMaps.length;o<u;o++)if(this.eventMaps[o]["in"].indexOf(t)!==-1){if(t===this.eventMaps[o].out){console.log("DMAF.EventMapper: ",t," is the same in event as output. Ignoring...");continue}s=this.eventMaps[o].delay||0,e.Clock.checkFunctionTime(n+s+e.preListen,e.ActionManager.onEvent,[],e.ActionManager,this.eventMaps[o].out,n+s+e.preListen,r)}else this.eventMaps[o]["in"][0]==="multi"&&(s=this.eventMaps[o].delay||0,e.Clock.checkFunctionTime(n+s+e.preListen,e.ActionManager.onEvent,[],e.ActionManager,this.eventMaps[o].out,n+s+e.preListen,r))}}}),e.registerInstance(t,"EventMapper",r),i.prototype=Object.create(n,{init:{value:function(){for(var e=0,t=this.eventMaps.length;e<t;e++)this.eventMaps[e]["in"]=parseInt(this.eventMaps[e]["in"],10),isNaN(this.eventMaps[e]["in"])&&console.log("In value for MidiNoteMapper is NaN!")}},onAction:{value:function(t,n,r,i){if(r&&r.midiNote)for(var s=0,o=this.eventMaps.length;s<o;s++)this.eventMaps[s]["in"]===r.midiNote&&e.ActionManager.onEvent(this.eventMaps[s].out,n,r)}}}),e.registerInstance(t,"MidiNoteMapper",i)}),dmaf.once("load_mediaElement",function(e){function r(){}function i(){}var t="mediaElement",n=e.InstancePrototype;r.prototype=Object.create(n,{currentTime:{get:function(){if(this.element)return this.element.currentTime},set:function(){console.log("MediaElement currentTime is read-only")}},onAction:{value:function(t,n,r,i){if(this.element)return null;var s=this.instanceId,o=e.pendingObjects[s];o?o instanceof HTMLElement&&(o.tagName==="VIDEO"||o.tagName==="AUDIO"?(this.element=o,this.playing=!1,this.lastPlayTime=o.currentTime,e.Clock.addFrameListener(this.type+":"+this.instanceId,this.poll,this)):console.log("DMAF does not support registering HTML elements other than <video> and <audio>")):console.log("DMAF Could not locate mediaElement with id",this.instanceId)}},poll:{value:function(){this.lastPlayTime===this.element.currentTime?this.playing&&(e.ActionManager.onEvent(this.instanceId+".STOP",e.context.currentTime*1e3),this.playing=!1):this.lastPlayTime>this.elementCurrentTime?(e.ActionManager.onEvent(this.instanceId+".STOP",e.context.currentTime*1e3),e.ActionManager.onEvent(this.instanceId+".START",(e.context.currentTime-this.currentTime)*1e3)):this.element.currentTime-this.lastPlayTime>.25?(e.ActionManager.onEvent(this.instanceId+".STOP",e.context.currentTime*1e3),e.ActionManager.onEvent(this.instanceId+".START",(e.context.currentTime-this.currentTime)*1e3)):this.playing||(e.ActionManager.onEvent(this.instanceId+".START",(e.context.currentTime-this.currentTime)*1e3),this.playing=!0),this.lastPlayTime=this.element.currentTime}}}),e.registerInstance(t,"MediaElement",r),e.mediaElement.MediaElement.removeInstance=function(n){var r=e.getInstance("mediaElement:"+n);return r&&e.Clock.removeFrameListener(t+":"+n),delete this.activeInstances[n]},i.prototype=Object.create(n,{onAction:{value:function(e,t,n,r){var i=/CREATE|REMOVE/.exec(e),s;i.length&&(i=i[0].toLowerCase(),s=e.split(".")[0],this[i](t,s))}},create:{value:function(n,r){var i=e.mediaElement.MediaElement.createInstance({instanceId:r,type:t,id:"MediaElement"});e.Clock.checkFunctionTime(n,i.onAction,[],i)}},remove:{value:function(t,n){return e.mediaElement.MediaElement.removeInstance(n)}}}),e.registerInstance("control","MediaController",i,!0)}),dmaf.once("load_midiProcessor",function(e){function i(){}function s(){}var t="midiProcessor",n={OFF:[0,0,0,0,0,0,0,0,0,0,0,0,0],major:[0,-1,0,-1,0,0,-1,0,-1,0,-1],harmonicMinor:[0,1,0,0,-1,0,1,0,0,-1,1,0],naturalMinor:[0,-1,0,0,-1,0,-1,0,0,-1,0,-1]},r={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11};i.prototype=Object.create(e.InstancePrototype,{updateValues:{value:["transpose","scale","root"]},scale:{get:function(){return this._scale},set:function(e){this._scale=n[e]}},root:{get:function(){return this._root},set:function(e){this._root=r[e]}},onAction:{value:function(e,t,n,r){if(!n||!n.midiNote){console.log("no eventProperties");return}this.transpose&&(this.transpose=parseInt(this.transpose,10),n.midiNote+=this.transpose),this.scale&&this.quantizeToScale(n)}},quantizeToScale:{value:function(e){var t,n;return e.midiNote&&(t=e.midiNote%12,t-=this._root,t<0&&(t=12+t),e.midiNote+=this.scale[t]),e}}}),e.registerInstance(t,"MidiProcessor",i),s.prototype=Object.create(e.InstancePrototype,{init:{value:function(){for(var t=0,n=this.noteMaps.length;t<n;t++)this.noteMaps[t].midiNote=e.Utils.toMIDINote(this.noteMaps[t].note)}},onAction:{value:function(t,n,r,i){var s;for(var o=0,u=this.noteMaps.length;o<u;o++)t===this.noteMaps[o].triggerIn&&(s={type:"noteOn",midiNote:this.noteMaps[o].midiNote,velocity:this.noteMaps[o].velocity,duraiton:this.noteMaps[o].duration},e.ActionManager.onEvent(this.noteMaps[o].triggerOut,n,s))}}}),e.registerInstance(t,"MakeNote",s)}),dmaf.once("load_parameterProcessor",function(e){function r(e){this.timeoutContainer=[]}function i(){}var t="parameterProcessor",n=e.InstancePrototype;r.prototype=Object.create(n,{onAction:{value:function(t,n,r){this.targets.length&&(this.multiSuffix&&(this.targets[0]=t.replace(this.multiSuffix,""),this.targets.length=1),e.Clock.checkFunctionTime(this.actionTime,this.execute,this.timeoutContainer,this,n))}},execute:{value:function(t){var n;while(this.targets.length)n=e.getInstance(this.targetType,this.targets.shift()),n&&(console.log("Transforming",this.targetParameter,"of",n.instanceId),n.setProperty(this.targetParameter,this.value,this.duration,t))}}}),e.registerInstance(t,"Transform",r,!0),i.prototype=Object.create(n,{onAction:{value:function(t,n,r){var i,s,o;for(var u=0,a=this.targets.length;u<a;u++)i=this.targets[u],o=e.getInstance(i.targetType,i.targetId),o&&(s=i.min+(i.max-i.min)*this.value,o.setProperty(i.targetParameter,s,this.duration,n))}}}),e.registerInstance(t,"Macro",i)}),dmaf.once("load_player",function(e){function i(t){this.state=this.STOPPED,this.pendingPatterns=[],this.activePatterns=[],this.pendingEvents=[],this.tempo=120,this.songPosition=new e.Processor.BeatPosition(0,16,16),this.currentPattern=new e.Processor.BeatPatternInstance(this,{beatPattern:new e.Processor.BeatPattern("master",1),channel:"master",addAtSongPosition:new e.Processor.BeatPosition(1,1,16),patternStartPosition:1,clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:16,clearPosition:new e.Processor.BeatPosition(1,1,16)})}function s(){var t=(new Date).getTime(),n=e.context.currentTime*1e3,i,o;return r&&(s.lastDifference=i,r=!1),i=t-n,o=i-s.lastDifference,Math.abs(o)>5?(console.log("DMAF: Adjusting next beat Time. Difference was "+o+"ms"),s.lastDifference=i,o):0}function o(e){this.activePatterns=[]}var t="player",n=e.InstancePrototype,r=!0;i.prototype=Object.create(n,{STOPPED:{value:0},RUNNING:{value:1},tempo:{get:function(){return this._tempo},set:function(t){this._tempo=t,this.beatLength=60/t*250,e.dispatch("tempo_"+this.instanceId,this._tempo)}},onAction:{value:function(t,n,r,i){if(i.flowItems){var s=i.flowItems,o,u;for(var a=0,f=s.length;a<f;a++){o=Object.create(s[a]),o.patternId==="trigger"&&(o.patternId=t);if(o._dynamicValues)for(var l=0,c=o._dynamicValues.length;l<c;l++)u=o._dynamicValues[l],o[u.key]=e.getInstanceProperty(u.string);switch(o.id){case"start":if(this.state===this.RUNNING)break;if(o.delay){var h=o.delay?n+o.delay:n;e.Clock.checkFunctionTime(h,this.start,[],this,o,h)}else this.start(o,n);break;case"add":e.Clock.checkFunctionTime(n,this.addPattern,[],this,o);break;case"stop":if(this.state===this.STOPPED)break;e.Clock.checkFunctionTime(n,this.stop,[],this,o);break;case"beatEvent":e.Clock.checkFunctionTime(n,this.beatEvent,[],this,o)}}}}},addPattern:{value:function(t){if(this.state===this.RUNNING){t.beatPattern=e.getAsset("beatPattern",t.patternId),t.addAtSongPosition=this.getSongPosition(t.songPosition),t.startPatternAtBeat=this.getStartAtBeat(t.patternPosition),t.clearPosition=this.getSongPosition(t.clearPosition);var n=new e.Processor.BeatPatternInstance(this,t);if(t.clearPending)if(t.channel==="main")this.pendingPatterns.length=0;else{var r=this.pendingPatterns.length;while(r--)this.pendingPatterns[r].channel===t.channel&&this.pendingPatterns.splice(r,1)}n.ERROR||this.pendingPatterns.push(n)}else console.log("BeatPatternPlayer: Cannot add pattern while player is not running.",t.patternId)}},checkBeat:{value:function(){var t=e.context.currentTime*1e3;while(t-this.nextBeatTime-e.preListen>this.beatLength)this.skipBeat(this.nextBeatTime);while(t>=this.nextBeatTime-e.preListen)this.updateBeat(this.nextBeatTime)}},skipBeat:{value:function(e){this.songPosition.gotoNextBeat(),this.nextBeatTime=e+this.beatLength;for(var t=0,n=this.activePatterns.length;t<n;t++)this.activePatterns[t].gotoNextBeat();this.updateActivePatterns()}},updateBeat:{value:function(e){this.nextBeatTime=e+this.beatLength-s(),this.songPosition.gotoNextBeat();for(var t=0,n=this.activePatterns.length;t<n;t++)this.activePatterns[t].gotoNextBeat();var r=this.songPosition.beat;this.updateActivePatterns();for(t=0,n=this.activePatterns.length;t<n;t++)this.activePatterns[t].executeEvents(e,this.beatLength)}},updateActivePatterns:{value:function(){var e,t,n,r,i,s;for(var o=0;o<this.pendingPatterns.length;o++){r=this.pendingPatterns[o].addAtSongPosition;if(r.bar===this.songPosition.bar&&r.beat===this.songPosition.beat){e=this.pendingPatterns[o],this.pendingPatterns.splice(o--,1);if(e.replaceActive)for(i=0,s=this.activePatterns.length;i<s;i++)if(e.channel==="main"||e.channel===this.activePatterns[i].channel)this.activePatterns[i].removeAtSongPosition=e.clearPosition;e.setAsCurrent&&(this.currentPattern=e),this.activePatterns.push(e)}}for(o=0;o<this.activePatterns.length;o++)t=this.activePatterns[o].removeAtSongPosition,t.bar===this.songPosition.bar&&t.beat===this.songPosition.beat?this.activePatterns.splice(o--,1):t.bar<this.songPosition.bar&&this.activePatterns.splice(o--,1)}},start:{value:function(t,n){this.tempo=t.tempo||120,this.nextBeatTime=n,this.beatsPerBar=t.beatsPerBar,this.state=this.RUNNING,e.Clock.addFrameListener("checkBeat",this.checkBeat,this)}},stop:{value:function(t){var n=this.getSongPosition(t.songPosition).getInBeats(),r=this.songPosition.getInBeats(),i=(n-r)*this.beatLength;i+=e.context.currentTime*1e3,i=Math.max(e.context.currentTime*1e3,i),e.Clock.checkFunctionTime(i,this.proceedStop,[],this,t)}},proceedStop:{value:function(t){this.state=this.STOPPED,this.pendingPatterns.length=0,this.activePatterns.length=0,e.Clock.removeFrameListener("checkBeat"),this.songPosition=new e.Processor.BeatPosition(0,this.beatsPerBar,this.beatsPerBar),this.currentPattern=new e.Processor.BeatPatternInstance(this,{beatPattern:new e.Processor.BeatPattern("MASTER",1),channel:"MASTER",addAtSongPosition:new e.Processor.BeatPosition(1,1,16),patternStartPosition:1,clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:16,clearPosition:new e.Processor.BeatPosition(1,1,16)})}},beatEvent:{value:function(t){var n=this.getSongPosition(t.songPosition).getInBeats(),r=this.songPosition.getInBeats(),i=(n-r)*this.beatLength;i+=e.context.currentTime*1e3;switch(t.output){case"onEvent":e.Clock.checkFunctionTime(i,e.ActionManager.onEvent,this.pendingEvents,e.ActionManager,t.returnEvent);break;case"dispatch":e.Clock.checkFunctionTime(i,e.dispatch,this.pendingEvents,e,t.returnEvent)}}},getSongPosition:{value:function(t){var n=t,r=0,i=0,s,o=new e.Processor.BeatPosition(this.songPosition.bar,this.songPosition.beat,this.beatsPerBar);/\+/.test(n)&&(s=n.split("+"),n=s[0],s=s[1].split("."),i=parseInt(s[0],10)||0,r=parseInt(s[1],10)||0);switch(n){case"NEXT_BEAT":o.addOffset({bar:0,beat:1});break;case"NEXT_BAR":o.beat=1,o.bar++;break;case"ASAP":return o;default:console.log("BeatPatternPlayer getSongPosition: Unrecognized songPosition ",n)}return o.bar+=i,o.beat+=r,o}},getStartAtBeat:{value:function(e){var t=e,n=0,r=0,i,s=this.currentPattern&&this.currentPattern.currentBeat||1;if(!t)return 1;/\+/.test(t)&&(i=t.split("+"),t=i[0],i=i[1].split("."),r=parseInt(i[0],10)||0,n=parseInt(i[1],10)||0);switch(t){case"FIRST_BEAT":s=1;break;case"SYNC":s++;break;default:console.log("BeatPatternPlayer: Unrecognized patternPosition "+t)}return s+=r*(this.currentPattern&&this.currentPattern.beatsPerBar||16),s+=n,s}}}),e.registerInstance(t,"BeatPatternPlayer",i),o.prototype=Object.create(n,{init:{value:function(){e.Clock.addFrameListener(this.instanceId,this.checkPatterns,this)}},onAction:{value:function(e,t,n,r){var i=e.split("."),s=i[1].toLowerCase(),o=i[0];this[s]&&this[s](o,t)}},start:{value:function(t,n){var r=e.getAsset("timePattern",t);r?(this.activePatterns.indexOf(r)===-1&&this.activePatterns.push(r),r.startTime=n):console.log("No time pattern with id ",t,"exists.")}},stop:{value:function(t,n){var r=e.getAsset("timePattern",t),i;r?(this.behavior==="DEFAULT"&&(r.startTime=-1),i=this.activePatterns.indexOf(r),i!==-1&&this.activePatterns.splice(i,1)):console.log("No time pattern with id ",t,"exists.")}},checkPatterns:{value:function(){for(var e=0,t=this.activePatterns.length;e<t;e++)this.activePatterns[e].executeEvents(this.behavior)}}}),e.registerInstance(t,"TimePatternPlayer",o)}),dmaf.once("load_sound",function(e){function s(){}function o(t){this.iterator=new e.Iterator(t.soundFiles,t.generator)}function u(){}function a(t,n,r,i){n<e.context.currentTime&&(n=e.context.currentTime+this.delay);var s=t.replace(this.multiSuffix,""),o=e.getInstance("sound",s);o&&o.stop(n)}function f(t,n,r,i){var s;n<e.context.currentTime*1e3&&(n=e.context.currentTime*1e3+this.delay);for(var o=0,u=this.targets.length;o<u;o++)s=e.getInstance("sound",this.targets[o]),s&&s.stop(n)}var t="sound",n=0,r=e.Clock,i=Object.create(e.InstancePrototype,{init:{value:function(t){this.pendingPlays=[],this.pendingStops=[],this.pendingEvents=[],this.sounds=[],this.playing=!1,this.previousActionTime=0;if(!t.bus||t.bus==="master")this.targetBus=e.context.destination;else{var n=e.getInstance("audioRouter",t.bus);this.targetBus=n?n.input:e.context.destination}}},clearAll:{value:function(){var e=this.sounds,t=e.length;while(t--)this.sounds[t].noteOff(0);this.sounds.length=0,this.playing=!1}},createSound:{value:function(){var t=e.context.createBufferSource(),r=e.getAsset("buffer",this.getSoundFile());return r?(t.id=n++,t.buffer=r,t.gain.value=this.waVolume,t.connect(this.targetBus),t.loop=!1,t):(console.log("GenericPlay: Buffer is missing. Check soundFile property."),{buffer:{duration:-1}})}},dispose:{value:function(e){var t=this.sounds.length;while(t--)this.sounds[t].id===e&&this.sounds.splice(t,1);this.playing=!!this.sounds.length}},play:{value:function(e){r.dropPendingArray(this.pendingStops),this.playing?(this.reTrig>-1&&(r.dropPendingArray(this.pendingPlays),r.dropPendingArray(this.pendingEvents)),this.reTrig===0||this.timingCorrection==="RESYNC"?r.checkFunctionTime(e,this.proceedPlay,this.pendingPlays,this,e):this.reTrig>0&&e-this.previousActionTime>this.reTrig&&(this.previousActionTime=e,r.checkFunctionTime(e,this.proceedPlay,this.pendingPlays,this,e))):(this.previousActionTime=e,r.checkFunctionTime(e,this.proceedPlay,this.pendingPlays,this,e))}},proceedPlay:{value:function(t){var n=this.createSound(),i=Math.abs(t-e.context.currentTime*1e3),s=n.buffer.duration*1e3,o=s-i,u=t+(this.loop||s);switch(this.timingCorrection){case"PLAY":n.noteOn(t/1e3);break;case"SYNC":if(o<=0)return;n.noteGrainOn(Math.max(0,t/1e3),i/1e3,o/1e3);break;case"RESYNC":if(o<=0)return;this.clearAll(),n.noteGrainOn(Math.max(0,t/1e3),i/1e3,o/1e3)}this.returnEvent&&r.checkFunctionTime(t+s+this.returnEventTime,e.ActionManager.onEvent,this.pendingEvents,e.ActionManager,this.returnEvent,t+s+this.returnEventTime),this.loop>-1?(r.checkFunctionTime(u,this.play,this.pendingPlays,this,u),r.checkFunctionTime(u,this.dispose,[],this,n.id),n.noteOff(t/1e3+n.buffer.duration)):r.checkFunctionTime(t+s,this.dispose,[],this,n.id),this.playing=!0,this.sounds.push(n)}},stop:{value:function(e){r.dropPendingArray(this.pendingEvents),r.dropPendingArray(this.pendingPlays),r.checkFunctionTime(e,this.proceedStop,this.pendingStops,this)}},proceedStop:{value:function(){var t=this.sounds.length;this.clearAll(),e.sound[this.id].removeInstance(this.instanceId)}},verify:{value:e.Utils.verify},volume:{get:function(){return this.sounds.length?this.sounds[this.sounds.length-1].gain:this._volume},set:function(t){this._volume=t,this.waVolume=e.Utils.dbToWAVolume(this._volume)}},onAction:{value:function(e,t,n,r){this.soundFile==="multi"&&(this.soundFile=e),this.play(t)}}});s.prototype=Object.create(i,{getSoundFile:{value:function(){return this.soundFile}}}),e.registerInstance(t,"GenericPlay",s),o.prototype=Object.create(i,{getSoundFile:{value:function(){return this.iterator.getNext()}}}),e.registerInstance(t,"StepPlay",o),u.prototype=Object.create(e.InstancePrototype,{init:{value:function(e){this.onAction=this.targets[0]==="multi"?a:f}}}),e.registerInstance(t,"SoundStop",u,!0)}),dmaf.once("load_stateProcessor",function(e){function i(e){this.value=undefined,this.previous=undefined}var t="stateProcessor",n="in",r=/PREVIOUS/;i.prototype=Object.create(e.InstancePrototype,{onAction:{value:function(t,i,s,o){var u,a,f,l,c;for(a=0,f=this.stateMaps.length;a<f;a++)for(l=0,c=this.stateMaps[a][n].length;l<c;l++)this.stateMaps[a][n][l]===t&&(u=this.stateMaps[a].state,this.stateMaps[a]._dynamicValues&&(u=e.getInstanceProperty(this.stateMaps[a]._dynamicValues[0].string)),a=f,l=c);if(!u)return console.log("StateProcesor: No state found for",t);r.test(u)&&(u=this.previous);switch(this.update){case"always":this.previous=this.value,this.value=u;break;case"onChange":u!==this.value&&(this.previous=this.value,this.value=u)}}}}),e.registerInstance(t,"State",i)}),dmaf.once("load_synth",function(e){function o(t){this.input=e.context.createGainNode(),this.output=e.context.createGainNode(),this.Note=l.call(this,t)}function u(t,n,r){if(t)this.input.connect(this.output),this.output.connect(t);else{var i=this.input;this.effects=e.Utils.createEffectsRecursive(i,n),this.effects.length>0&&(i=this.effects[this.effects.length-1]),i.connect(this.output);if(!r||r==="master")this.output.connect(e.context.master);else{var s=e.getInstance("audioRouter",r);s?this.output.connect(s.input):this.output.connect(e.context.destination)}}}function a(){var t=e.context.currentTime,n=this.samples.active,r=this.samples.sustained,i;for(var s in n){i=n[s].length;while(i--)n[s][i].disposeTime<=t&&n[s].splice(i,1)}i=r.length;while(i--)r[i].disposeTime<=t&&r.splice(i,1)}function f(t,n,r){var i=this._loop&&this._sustain,s=this._loop?Infinity:t.bufferLength*1e3-t.ampRelease,o=this.ignoreNoteOff?s:r?r:s,u=n+(i?Infinity:o);isFinite(u)&&t._noteOff(u),this.sustained||!r?(this.samples.sustained.push(t),this.samples.sustained.length>this.numberOfVoices&&this.samples.sustained[0]._noteOff(e.context.currentTime*1e3)):this.samples.active[t.midiNote].push(t)}function l(t){function s(t){this.bufferSource=e.context.createBufferSource(),this.amp=e.context.createGainNode(),this.filter=this.filterOn&&e.context.createBiquadFilter(),this.bufferSource.connect(this.filter||this.amp),this.filter&&this.filter.connect(this.amp),this.amp.connect(this.output),this.parent=t.parent,this.midiNote=t.midiNote,this.bufferSource.gain.value=t.sampleGain!==undefined?i(parseInt(t.sampleGain,10)):1,this.bufferSource.playbackRate.value=n(this.midiNote)/n(r(t.baseNote)),this.bufferSource.buffer=e.getAsset("buffer",t.buffer),this.bufferLength=this.bufferSource.buffer.length/e.context.sampleRate,this.velocity=Math.pow(t.velocity/127,1.2),this.bufferSource.loop=this.parent.loop,this.filterOn&&(this.filter.Q.value=this.filterQ,this.filter.gain=this.filterGain)}return s.prototype=Object.create(this),s.prototype.output=this.input,s.prototype._noteOn=c.noteOn,s.prototype._noteOff=c.noteOff,s}var t="synth",n=e.Utils.MIDIToFrequency,r=e.Utils.toMIDINote,i=e.Utils.dbToWAVolume,s=e.InstancePrototype;o.prototype=Object.create(s,{init:{value:function(t){u.apply(this,[t.output,t.audioNodes,t.bus]),this._sustain=!1,this.samples={meta:Object.create(null),maps:Object.create(null),used:Object.create(null),active:Object.create(null),sustained:[]};var n;for(var r=0,i=t.sampleMapGroups[0].sampleMaps.length;r<i;r++)n=t.sampleMapGroups[0].sampleMaps[r].name.toLowerCase(),n=n==="multi"?this.instanceId.toLowerCase():n.toLowerCase(),this.samples.meta[n]=t.sampleMapGroups[0].sampleMaps[r];for(var s in this.samples.meta)this.samples.maps[s]=e.getAsset("sampleMap",s),this.samples.used[s]=Object.create(null);e.Clock.addFrameListener(this.instanceId,a,this)}},numberOfVoices:{value:16},volume:{get:function(){return this.output.gain.value},set:function(t){this.output.gain.value=e.Utils.dbToWAVolume(t)}},sustain:{get:function(){return this._sustain},set:function(t){if(t)this._sustain=!0;else{this._sustain=!1;for(var n=0,r=this.samples.sustained.length;n<r;n++)this.samples.sustained[n]._noteOff(e.context.currentTime*1e3)}}},filterSustain:{get:function(){return this._filterSustain},set:function(e){this._filterSustain=Math.pow(e,4)}},controller:{value:function(e){message.cc===64&&(this.sustain=this.verify("sustain",message.value))}},onAction:{value:function(e,t,n,r){if(!n)return;this[n.type]?this[n.type](t,n):console.log("Sampler does not recognize message ",n)}},getRange:{value:function(e,t){var n=this.samples.meta,i=this.samples.maps,s=this.samples.used,o=0,u=[],a,f,l,c,h,p;for(f in n)if(n[f].velocityLow<=t&&n[f].velocityHigh>=t){a=i[f];for(l in a)c=a[l],e>=r(c.low)&&e<=r(c.hi)&&u.push(c)}return u.length!==1&&(s[f][e]!==undefined&&(o=(s[f][e]+1)%u.length),s[f][e]=o),u[o]}},noteOn:{value:function(t,n){var r=this.samples.active,i=n.midiNote,s=n.velocity,o=n.duration||n.endTime,u=this.getRange(i,s),a;if(!u||!u.sound)return;if(!e.getAsset("buffer",u.sound))return;a=new this.Note({parent:this,sampleGain:u.vol,baseNote:u.root,buffer:u.sound,midiNote:i,velocity:s}),r[i]?r[i].length&&!this.ignoreNoteOff&&this.noteOff(t,n):r[i]=[],this.loop&&this.ignoreNoteOff&&(console.log("Sampler Configuration Error: You cannot use looped samples with ignoreNoteOff."),n.duration?this.ignoreNoteOff=!1:this.loop=!1),a._noteOn(t),f.apply(this,[a,t,o])}},noteOff:{value:function(t,n){var r=this.samples.active,i=this.samples.sustained,s=n.midiNote,o,u;if(!s||this.ignoreNoteOff)return;if(r[s])for(o=0,u=r[s].length;o<u;o++)r[s][o]._noteOff(t||e.context.currentTime*1e3);if(this.sustain)return;for(o=0,u=i.length;o<u;o++)i[o].midiNote===s&&i[o]._noteOff(t||e.context.currentTime*1e3)}},stopAll:{value:function(t){var n=this.samples.active,r=this.samples.sustained,i;for(var s in n){i=n[s].length;while(i--)n[s][i]._noteOff(e.context.currentTime);i=r.length;while(i--)r[i]._noteOff(e.context.currentTime)}}}});var c={noteOn:function(t){var r=t+this.ampAttack,i=r+this.ampDecay,s=1-this.ampVelocityRatio+this.velocity*this.ampVelocityRatio,o=Math.pow(this.ampSustain*s,2);this.noteOnTime=t,this.ampPeakValue=s,this.ampSustainValue=o,this.amp.gain.setValueAtTime(0,t/1e3),this.amp.gain.linearRampToValueAtTime(s,r/1e3),this.amp.gain.linearRampToValueAtTime(o,i/1e3);if(this.filterOn){var u=t+this.filterAttack,a=u+this.filterDecay,f=1-this.filterVelocityRatio+this.velocity*this.filterVelocityRatio,l=this.filterADSRAmount*f,c=this.filterFrequency+l,h=this.filterFrequency+this.filterSustain*l;c=n(c*12+this.midiNote),h=n(h*12+this.midiNote),c=c<20?20:c>2e4?2e4:c,h=h<20?20:h>2e4?2e4:h,this.filterFrequency=n(this.filterFrequency*12+this.midiNote),this.filter.frequency.setValueAtTime(this.filterFrequency,t/1e3),this.filter.frequency.linearRampToValueAtTime(c,u/1e3),this.filter.frequency.linearRampToValueAtTime(h,a/1e3)}this.bufferSource.noteOn(this.noteOnTime/1e3)},noteOff:function(t,n){var r,i,s;r=t+this.ampRelease,i=t+this.filterRelease,this.amp.gain.cancelScheduledValues(t/1e3),this.amp.gain.setValueAtTime(this.ampSustainValue,t/1e3),this.amp.gain.linearRampToValueAtTime(0,r/1e3),this.filter&&(this.filter.frequency.cancelScheduledValues(t/1e3),this.filter.frequency.setValueAtTime(this.filter.frequency.value,t/1e3),this.filter.frequency.linearRampToValueAtTime(this.filterFrequency,i/1e3)),this.bufferSource.noteOff(r/1e3),this.disposeTime=r/1e3,this.noteOffSent=!0}};e.registerInstance(t,"Sampler",o)}),dmaf.once("load_audioNode",function(e){function o(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function u(e){return e===0?1:Math.abs(e)/e}function a(e,t){var n,r,i=0,s=0,o=0,u=0;return n=e.toExponential().match(/^.\.?(.*)e(.+)$/),i=parseInt(n[2],10)-(n[1]+"").length,n=t.toExponential().match(/^.\.?(.*)e(.+)$/),s=parseInt(n[2],10)-(n[1]+"").length,s>i&&(i=s),r=e%t,i<-100||i>20?(o=Math.round(Math.log(r)/Math.log(10)),u=Math.pow(10,o),(r/u).toFixed(o-i)*u):parseFloat(r.toFixed(-i))}var t=e.AudioNodes=Object.create(null),n={lowpass:0,highpass:1,bandpass:2,lowshelf:3,highshelf:4,peaking:5,notch:6,allpass:7},r={32:.125,"16T":.16666666666666666,"32D":.1875,16:.25,"8T":.3333333333333333,"16D":.375,8:.5,"4T":.6666666666666666,"8D":.75,4:1,"2T":1.3333333333333333,"4D":1.5,2:2,"2D":3,1:4},i=function(e,t){e.value=t},s=Object.create(e.InstancePrototype,{activate:{writable:!0,value:function(e){this.input.disconnect(),this._activated=e,e?(this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(e)):this.input.connect(this.output)}},bypass:{get:function(){return this._activated},set:function(e){this.activate(e)}},connect:{value:function(e){this.output.connect(e)}},connectInOrder:{value:function(e){var t=e.length-1;while(t--){if(!e[t].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",e[t]);e[t].connect(e[t+1])}}},setAutomatableProperty:{value:function(t,n,r,i){var s=this.defaults[t],o=this[t],u;i=i?~~(i/1e3):e.context.currentTime,r=r=r?~~(r/1e3):0,o?(n=this.verify(t,n),s.automatable?(r?(u="linearRampToValueAtTime",o.cancelScheduledValues(i),o.setValueAtTime(o.value,i)):u="setValueAtTime",o[u](n,r+i)):o=n):console.error("Invalid Property for "+this.name)}},verify:{value:e.Utils.verify}});e.AudioNodes.Filter=function(t){this.input=e.context.createGainNode(),this.filter=this.activateNode=e.context.createBiquadFilter(),this.output=e.context.createGainNode(),this.filter.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.filter,this.frequency=t.frequency,this.Q=t.resonance,this.filterType=t.filterType,this.gain=t.gain},e.AudioNodes.Filter.prototype=Object.create(s,{name:{value:"Filter"},filterType:{enumerable:!0,get:function(){return this._filterType},set:function(e){this._filterType=this.verify("filterType",e),this.filter.type=n[this._filterType.toLowerCase()]}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(e){this.filter.Q.value=this.verify("Q",e)}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(e){this.filter.gain.value=this.verify("gain",e)}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(e){this.filter.frequency.value=this.verify("frequency",e)}}}),e.AudioNodes.Cabinet=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.convolver=this.newConvolver(t.impulsePath),this.makeupNode=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.cabinet,this.makeupGain=t.makeupGain,this.convolver.activate(!0)},e.AudioNodes.Cabinet.prototype=Object.create(s,{name:{value:"Cabinet"},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(e){this.makeupNode.gain.value=this.verify("makeupGain",e)}},newConvolver:{value:function(t){return new e.AudioNodes.Convolver({impulse:t,dryLevel:0,wetLevel:1})}}}),e.AudioNodes.Chorus=function(t){this.input=e.context.createGainNode(),this.attenuator=this.activateNode=e.context.createGainNode(),this.splitter=e.context.createChannelSplitter(2),this.delayL=e.context.createDelayNode(),this.delayR=e.context.createDelayNode(),this.feedbackGainNodeLR=e.context.createGainNode(),this.feedbackGainNodeRL=e.context.createGainNode(),this.merger=e.context.createChannelMerger(2),this.output=e.context.createGainNode(),this.lfoL=new e.AudioNodes.LFO({target:this.delayL.delayTime,callback:i}),this.lfoR=new e.AudioNodes.LFO({target:this.delayR.delayTime,callback:i}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.chorus,this.feedback=t.feedback,this.rate=t.rate,this.delay=t.delay,this.depth=t.depth,this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0)},e.AudioNodes.Chorus.prototype=Object.create(s,{name:{value:"Chorus"},delay:{enumerable:!0,get:function(){return this._delay},set:function(e){this._delay=2e-4*Math.pow(10,this.verify("delay",e)*2),this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(e){this._depth=this.verify("depth",e),this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(e){this._feedback=this.verify("feedback",e),this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=this.verify("rate",e),this.lfoL._frequency=this._rate,this.lfoR._frequency=this._rate}}}),e.AudioNodes.Compressor=function(t){this.input=e.context.createGainNode(),this.compNode=this.activateNode=e.context.createDynamicsCompressor(),this.makeupNode=e.context.createGainNode(),this.output=e.context.createGainNode(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.compressor,this.automakeup=t.automakeup,this.makeupGain=t.makeupGain,this.threshold=t.threshold,this.release=t.release,this.attack=t.attack,this.ratio=t.ratio,this.knee=t.knee},e.AudioNodes.Compressor.prototype=Object.create(s,{name:{value:"Compressor"},computeMakeup:{value:function(){var e=4,t=this.compNode;return-(t.threshold.value-t.threshold.value/t.ratio.value)/e}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(e){this._automakeup=this.verify("automakeup",e),this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(e){this.compNode.threshold.value=this.verify("threshold",e),this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(e){this.compNode.ratio.value=this.verify("ratio",e),this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(e){this.compNode.knee.value=this.verify("knee",e),this._automakeup&&(this.makeupGain=this.computeMakeup())}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(e){this.compNode.attack.value=this.verify("attack",e)/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(e){this.compNode.release=this.verify("release",e)/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){var n=this.verify("makeupGain",t);this.makeupNode.gain.value=e.Utils.dbToWAVolume(n)}}}),e.AudioNodes.Convolver=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.convolver=e.context.createConvolver(),this.dry=e.context.createGainNode(),this.filterLow=e.context.createBiquadFilter(),this.filterHigh=e.context.createBiquadFilter(),this.wet=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.convolver,this.dryLevel=t.dryLevel,this.wetLevel=t.wetLevel,this.highCut=t.highCut,this.buffer=t.impulse,this.lowCut=t.lowCut,this.level=t.level,this.filterHigh.type=0,this.filterLow.type=1},e.AudioNodes.Convolver.prototype=Object.create(s,{name:{value:"Convolver"},lowCut:{get:function(){return this.filterLow.frequency},set:function(e){this.filterLow.frequency.value=this.verify("lowCut",e)}},highCut:{get:function(){return this.filterHigh.frequency},set:function(e){this.filterHigh.frequency.value=this.verify("highCut",e)}},level:{get:function(){return this.output.gain},set:function(e){this.output.gain.value=this.verify("level",e)}},dryLevel:{get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=this.verify("dryLevel",e)}},wetLevel:{get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=this.verify("wetLevel",e),this.wet.gain=this.verify("wetLevel",e)}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer},set:function(t){var n=this.convolver,r=new XMLHttpRequest;if(!t){console.error("DMAF.AudioNodes.Convolver.setBuffer: Missing impulse path!");return}r.open("GET",t,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){r.readyState===4&&(r.status<300&&r.status>199||r.status===302)&&e.context.decodeAudioData(r.response,function(e){n.buffer=e},function(e){e&&console.error("DMAF.AudioNodes.Convolver.setBuffer: Error decoding data"+e)})},r.send(null)}}}),e.AudioNodes.Delay=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.dry=e.context.createGainNode(),this.wet=e.context.createGainNode(),this.filter=e.context.createBiquadFilter(),this.delay=e.context.createDelayNode(),this.feedbackNode=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.delay,this.tempoSync=t.tempoSync,this.tempoSync&&(this.subdivision=t.subdivision),this.delayTime=t.delayTime,this.feedback=t.feedback,this.wetLevel=t.wetLevel,this.dryLevel=t.dryLevel,this.cutoff=t.cutoff,this.filter.type=1},e.AudioNodes.Delay.prototype=Object.create(s,{name:{value:"Delay"},tempoListener:{value:function(e){this.tempo=e,this.delayTime=this.tempo}},tempoSync:{get:function(){return this._tempoSync},set:function(t){if(t&&typeof t=="string"){var n=e.getInstance("player:"+t);n?this.tempo=n.tempo:this.tempo=90,this._tempoSync=t,dmaf.addEventListener("tempo_"+this._tempoSync,this.tempoListener.bind(this))}else this._tempoSync=!1}},subdivision:{get:function(){return this._subdivision},set:function(e){this._subdivision=this.verify("subdivision",e)}},tempo:{get:function(){return this._tempo},set:function(e){this._tempo=e}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(e){this._tempoSync?this.delay.delayTime.value=this.verify("delayTime",60*r[this.subdivision]/this.tempo):this.delay.delayTime.value=this.verify("delayTime",e)/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=this.verify("wetLevel",e)}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=this.verify("dryLevel",e)}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(e){this.feedbackNode.gain.value=this.verify("feedback",e)}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(e){this.filter.frequency.value=this.verify("cutoff",e)}}}),e.AudioNodes.EnvelopeFollower=function(t){this.input=e.context.createGainNode(),this.jsNode=this.output=e.context.createJavaScriptNode(this.buffersize,1,1),this.input.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.envelopeFollower,this.attackTime=t.attackTime,this.releaseTime=t.releaseTime,this._envelope=0,this.target=t.target,this.callback=t.callback},e.AudioNodes.EnvelopeFollower.prototype=Object.create(s,{name:{value:"EnvelopeFollower"},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(e){this._attackTime=this.verify("attackTime",e),this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(e){this._releaseTime=this.verify("releaseTime",e),this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(e){typeof e=="function"?this._callback=e:console.error(this.name+": Callback must be a function! TypeError: ",e)}},target:{get:function(){return this._target},set:function(e){typeof e=="object"?this._target=e:console.error(this.name+": Callback must be an AudioParam interface! TypeError: ",e)}},activate:{value:function(t){this.activated=t,t?(this.jsNode.connect(e.context.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null)}},returnCompute:{value:function(e){return function(t){e.compute(t)}}},compute:{value:function(e){var t=e.inputBuffer.getChannelData(0).length,n=e.inputBuffer.numberOfChannels,r,i,s,o;i=s=0;if(n>1)for(o=0;o<t;++o)for(;i<n;++i)r=e.inputBuffer.getChannelData(i)[o],s+=r*r/n;else for(o=0;o<t;++o)r=e.inputBuffer.getChannelData(0)[o],s+=r*r;s=Math.sqrt(s),this._envelope<s?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*s):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*s),this._callback(this._target,this._envelope)}}}),e.AudioNodes.Equalizer=function(){function n(t){this._defaults=e.Settings.descriptors.type.audioNode.equalizer,this.nbands=t.bands.length;for(var n=0,r=this._nbands;n<r;n++);this.input=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode=e.context.createGainNode();return}function r(e,t){var n="band"+e+":"+t;Object.defineProperty(this,n,{enumerable:!0,get:function(){return this.bands[e][t]},set:function(n){t==="type"?this.bands[e][t]=this.verify(t,n):this.bands[e][t].value=this.verify(t,n)}}),this.defaults[n]=this._defaults[t]}function i(t){this.bands[t]=e.context.createBiquadFilter(),r.apply(this,[t,"frequency"]),r.apply(this,[t,"type"]),r.apply(this,[t,"gain"]),r.apply(this,[t,"Q"])}var t=["frequency","gain","Q","type"];return n}(),e.AudioNodes.Equalizer.prototype=Object.create(s,{name:{value:"Equalizer"},propertySearch:{value:/:bypass|:type|:frequency|:gain|:q/i}}),e.AudioNodes.LFO=function(){function t(t){this.output=e.context.createJavaScriptNode(256,1,1),this.activateNode=e.context.destination,this.defaults=e.Settings.descriptors.type.audioNode.lfo,this.type=t.type,this.frequency=t.frequency,this.offset=t.offset,this.oscillation=t.oscillation,this.phase=t.phase,this.target=t.target,this.output.onaudioprocess=this.callback(t.callback)}return t.prototype=Object.create(s,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},type:{enumerable:!0,get:function(){return this._type},set:function(e){this._type=this.verify("type",e)}},frequency:{get:function(){return this._frequency},set:function(e){this._frequency=this.verify("frequency",e),this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(e){this._offset=this.verify("offset",e)}},oscillation:{get:function(){return this._oscillation},set:function(e){this._oscillation=this.verify("oscillation",e)}},phase:{get:function(){return this._phase},set:function(e){this._phase=this.verify("phase",e)}},target:{get:function(){return this._target},set:function(e){this._target=e}},activate:{value:function(t){this._activated=t,t?this.output.connect(e.context.destination):this.output.disconnect(e.context.destination)}},callback:{value:function(e){var t=this;return function(){t._phase+=t._phaseInc,t._phase>2*Math.PI&&(t._phase=0),e(t._target,t._offset+t._oscillation*Math.sin(t._phase))}}}}),t}(),e.AudioNodes.Overdrive=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.inputDrive=e.context.createGainNode(),this.waveshaper=e.context.createWaveShaper(),this.outputDrive=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.overdrive,this.ws_table=new Float32Array(this.k_nSamples),this.drive=t.drive,this.outputGain=t.outputGain,this.curveAmount=t.curveAmount,this.algorithm=t.algorithmIndex},e.AudioNodes.Overdrive.prototype=Object.create(s,{name:{value:"Overdrive"},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(e){this._drive=this.verify("drive",e)}},curveAmount:{get:function(){return this._curveAmount},set:function(e){this._curveAmount=this.verify("curveAmount",e),this._algorithmIndex===undefined&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(t){var n=this.verify("outputGain",t);this._outputGain=e.Utils.dbToWAVolume(n)}},algorithm:{get:function(){return this._algorithmIndex},set:function(e){this._algorithmIndex=this.verify("algorithmIndex",e),this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(e,t,n){var r=2*e/(1-e),i,s;for(i=0;i<t;i++)s=i*2/t-1,n[i]=(1+r)*s/(1+r*Math.abs(s))},function(e,t,n){var r,i,s;for(r=0;r<t;r++)i=r*2/t-1,s=(.5*Math.pow(i+1.4,2)-1)*s>=0?5.8:1.2,n[r]=o(s)},function(e,t,n){var r,i,s,u=1-e;for(r=0;r<t;r++)i=r*2/t-1,s=i<0?-Math.pow(Math.abs(i),u+.04):Math.pow(i,u),n[r]=o(s*2)},function(e,t,n){var r,i,s,o,a=1-e>.99?.99:1-e;for(r=0;r<t;r++)i=r*2/t-1,o=Math.abs(i),o<a?s=o:o>a?s=a+(o-a)/(1+Math.pow((o-a)/(1-a),2)):o>1&&(s=o),n[r]=u(i)*s*(1/((a+1)/2))},function(e,t,n){var r,i;for(r=0;r<t;r++)i=r*2/t-1,i<-0.08905?n[r]=-3/4*(1-Math.pow(1-(Math.abs(i)-.032857),12)+1/3*(Math.abs(i)-.032847))+.01:i>=-0.08905&&i<.320018?n[r]=-6.153*i*i+3.9375*i:n[r]=.630035},function(e,t,n){var r=2+Math.round(e*14),i=Math.round(Math.pow(2,r-1)),s,o;for(s=0;s<t;s++)o=s*2/t-1,n[s]=Math.round(o*i)/i}]}}),e.AudioNodes.PingPongDelay=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.dry=e.context.createGainNode(),this.splitter=e.context.createChannelSplitter(2),this.toMono=e.context.createGainNode(),this.wet=e.context.createGainNode(),this.feedbackNode=e.context.createGainNode(),this.delayL=new e.AudioNodes.Delay(t),this.delayR=new e.AudioNodes.Delay(t),this.merger=e.context.createChannelMerger(),this.output=e.context.createGainNode(),this.activateNode.connect(this.dry),this.activateNode.connect(this.splitter),this.splitter.connect(this.toMono,0,0),this.splitter.connect(this.toMono,1,0),this.toMono.connect(this.wet),this.wet.connect(this.delayL.delay),this.feedbackNode.connect(this.delayL.delay),this.delayL.delay.connect(this.delayR.delay),this.delayR.delay.connect(this.feedbackNode),this.delayL.delay.connect(this.merger,0,0),this.delayR.delay.connect(this.merger,0,1),this.dry.connect(this.output),this.merger.connect(this.output),this.delayL.feedback=0,this.delayR.feedback=0,this.delayL.wetLevel=1,this.delayR.wetLevel=1,this.delayL.dryLevel=0,this.delayR.dryLevel=0,this.defaults=e.Settings.descriptors.type.audioNode.pingPongDelay,this.cutoff=t.cutoff,this.tempoSync=t.tempoSync,this.tempoSync&&(this.subdivision=t.subdivision),this.delayTime=t.delayTime,this.feedback=t.feedback,this.wetLevel=t.wetLevel,this.dryLevel=t.dryLevel},e.AudioNodes.PingPongDelay.prototype=Object.create(s,{name:{value:"PingPongDelay"},tempoSync:{get:function(){return this._tempoSync},set:function(t){var n=t?e.getInstance("player",t):null;n?this.tempo=n.tempo:this.tempo=120,this._tempoSync=this.verify("tempoSync",t),this.delayL.tempoSync=this._tempoSync,this.delayR.tempoSync=this._tempoSync}},tempo:{get:function(){return this._tempo},set:function(e){this._tempo=e,this.delayL.tempo=e,this.delayR.tempo=e}},subdivision:{get:function(){return this._subdivision},set:function(e){this._subdivision=this.verify("subdivision",e),this.delayL.subdivision=this._subdivision,this.delayR.subdivision=this._subdivision}},delayTime:{enumerable:!0,get:function(){return this._delayTime},set:function(e){this._tempoSync?(this._delayTime=this.verify("delayTime",60*r[this.subdivision]/this.tempo),this.delayL.delayTime=this._delayTime,this.delayR.delayTime=this._delayTime):(this._delayTime=this.verify("delayTime",e)/1e3,this.delayL.delayTime=e,this.delayR.delayTime=e)}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=this.verify("wetLevel",e)}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=this.verify("dryLevel",e)}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(e){this.feedbackNode.gain.value=this.verify("feedback",e)}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(e){this.delayL.filter.frequency.value=this.verify("cutoff",e),this.delayR.filter.frequency.value=this.verify("cutoff",e)}}}),e.AudioNodes.Phaser=function(t){this.input=e.context.createGainNode(),this.splitter=this.activateNode=e.context.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=e.context.createGainNode(),this.feedbackGainNodeR=e.context.createGainNode(),this.merger=e.context.createChannelMerger(2),this.filteredSignal=e.context.createGainNode(),this.output=e.context.createGainNode(),this.lfoL=new e.AudioNodes.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new e.AudioNodes.LFO({target:this.filtersR,callback:this.callback});var n=this.stage;while(n--)this.filtersL[n]=e.context.createBiquadFilter(),this.filtersR[n]=e.context.createBiquadFilter(),this.filtersL[n].type=7,this.filtersR[n].type=7;this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.phaser,this.rate=t.rate,this.baseModulationFrequency=t.baseModulationFrequency,this.depth=t.depth,this.feedback=t.feedback,this.stereoPhase=t.stereoPhase,this.lfoL.activate(!0),this.lfoR.activate(!0)},e.AudioNodes.Phaser.prototype=Object.create(s,{name:{value:"Phaser"},stage:{value:4},callback:{value:function(e,t){for(var n=0;n<4;n++)e[n].frequency.value=t}},depth:{enumerable:!0,get:function(){return this._depth},set:function(e){this._depth=this.verify("depth",e),this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=this.verify("rate",e),this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(e){this._baseModulationFrequency=this.verify("baseModulationFrequency",e),this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency,this._depth=this.verify("depth",this._depth)}},feedback:{get:function(){return this._feedback},set:function(e){this._feedback=this.verify("feedback",e),this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(e){this._stereoPhase=this.verify("stereoPhase",e);var t=this.lfoL._phase+this._stereoPhase*Math.PI/180;t=a(t,2*Math.PI),this.lfoR._phase=t}}}),e.AudioNodes.Tremolo=function(t){this.input=e.context.createGainNode(),this.splitter=this.activateNode=e.context.createChannelSplitter(2),this.amplitudeL=e.context.createGainNode(),this.amplitudeR=e.context.createGainNode(),this.merger=e.context.createChannelMerger(2),this.output=e.context.createGainNode(),this.lfoL=new e.AudioNodes.LFO({target:this.amplitudeL.gain,callback:i}),this.lfoR=new e.AudioNodes.LFO({target:this.amplitudeR.gain,callback:i}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.tremolo,this.rate=t.rate,this.intensity=t.intensity,this.stereoPhase=t.stereoPhase,this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0)},e.AudioNodes.Tremolo.prototype=Object.create(s,{name:{value:"Tremolo"},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(e){this._intensity=this.verify("intensity",e),this.lfoL.offset=this._intensity/2,this.lfoR.offset=this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=this.verify("rate",e),this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},steroPhase:{enumerable:!0,get:function(){return this._rate},set:function(e){this._stereoPhase=this.verify("stereoPhase",e);var t=this.lfoL._phase+this._stereoPhase*Math.PI/180;t=a(t,2*Math.PI),this.lfoR.phase=t}}}),e.AudioNodes.WahWah=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.envelopeFollower=new e.AudioNodes.EnvelopeFollower({target:this,callback:function(e,t){e.sweep=t}}),this.filterBp=e.context.createBiquadFilter(),this.filterPeaking=e.context.createBiquadFilter(),this.output=e.context.createGainNode(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.wahWah,this.init(),this.automode=t.enableAutoMode,this.resonance=t.resonance,this.sensitivity=t.sensitivity,this.baseFrequency=t.baseModulationFrequency,this.excursionOctaves=t.excursionOctaves,this.sweep=t.sweep,this.envelopeFollower.activate(!0)},e.AudioNodes.WahWah.prototype=Object.create(s,{name:{value:"WahWah"},activateCallback:{value:function(e){this.automode=e}},automode:{get:function(){return this._automode},set:function(e){this._automode=e,e?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},sweep:{enumerable:!0,get:function(){return this._sweep.value},set:function(e){this._sweep=Math.pow(e>1?1:e<0?0:e,this._sensitivity),this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=50*Math.pow(10,this.verify("baseFrequency",e)*2),this._excursionFrequency=Math.min(this.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(e){this._excursionOctaves=this.verify("excursionOctaves",e),this._excursionFrequency=Math.min(this.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(e){this._sensitivity=this.verify("sensitivity",e),this._sensitivity=Math.pow(10,this._sensitivity)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(e){this._resonance=this.verify("resonance",e),this.filterPeaking.Q=this._resonance}},init:{value:function(){var t=Object.keys(this.defaults),n,r;this.output.gain.value=5,this.filterPeaking.type=5,this.filterBp.type=2,this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1,this.sampleRate=e.context.sampleRate;for(n=0,r=t.length;n<r;n++)this[t[n]]=this.defaults[t[n]].value}}})}),dmaf.once("load_beatPattern",function(e){function t(e,t,n,r){this.eventName=e,this.beat=t,this.tick=n||1,this.data=r}function n(t){return new e.Processor.BeatPosition(t.bar,t.beat,this.player.beatsPerBar)}e.Processor={},e.Processor.TimePattern=function(e,t){this.patternId=e,this.events=t,this.startTime=-1,this.lastExecutedEventTime=-1},e.Processor.TimePattern.prototype={executeEvents:function(t){var n=e.context.currentTime*1e3-this.startTime,r=-1;switch(t){case"LINEAR":this.executeLinear(n,r);break;case"DEFAULT":this.executeDefault(n,r);break;default:console.log("Invalid behavior type for TimePattern",this.behavior)}},executeLinear:function(t,n){var r,i;for(r=0,i=this.events.length;r<i;r++)this.events[r].absoluteTime>this.lastExecutedEventTime&&t>this.events[r].absoluteTime-e.preListen&&(e.ActionManager.onEvent(this.events[r].trigger,this.startTime+this.events[r].absoluteTime,this.events[r]),this.lastExecutedEventTime=this.events[r].absoluteTime)},executeDefault:function(t,n){var r,i;if(this.lastExecutedEventTime===-1){for(r=0,i=this.events.length;r<i;r++)t>this.events[r].absoluteTime-e.preListen&&(e.ActionManager.onEvent(this.events[r].trigger,this.startTime+this.events[r].absoluteTime,this.events[r]),n=this.events[r].absoluteTime);this.lastExecutedEventTime=n}else this.executeLinear(t,n)}},e.Processor.BeatPatternInstance=function(t,r){if(!r.beatPattern){console.error("Found no BeatPattern for channel",r.channel,". Please check MIDI file."),this.ERROR=!0;return}this.addAtSongPosition=r.addAtSongPosition,this.currentBeat=r.startPatternAtBeat,this.replaceActive=r.replaceActive,this.clearPosition=r.clearPosition,this.setAsCurrent=r.setAsCurrent,this.beatPattern=r.beatPattern,this.patternId=r.patternId,this.channel=r.channel,this.loop=r.loop,this.player=t;if(this.loop)r.loopLength?(this.loopLength=r.loopLength,this.removeAtSongPosition=new e.Processor.BeatPosition(Infinity,1,this.player.beatsPerBar)):console.error("You must specify a loopLength for pattern "+this.patternId+" if loop is set to true."),this.currentBeat===this.loopLength&&(console.log(this.currentBeat),this.currentBeat=1);else{this.removeAtSongPosition=n.call(this,this.addAtSongPosition);var i=this.beatPattern.endPosition-this.currentBeat;this.removeAtSongPosition.addOffset({bar:0,beats:i})}},e.Processor.BeatPatternInstance.prototype={gotoNextBeat:function(){this.currentBeat++,this.loop&&this.currentBeat>this.loopLength&&(this.currentBeat=1)},executeEvents:function(e,t){var n=this.beatPattern.events[this.currentBeat];if(!n)return;for(var r=0,i=n.length;r<i;r++)n[r].execute(e,t)}},e.Processor.BeatPattern=function(e,t){this.events={},this.patternId=e,this.startPosition=t||1,this.endPosition=0},e.Processor.BeatPattern.prototype={addEvent:function(e,n,r,i){this.events[n]=this.events[n]||[],this.events[n].push(new t(e,n,r,i)),n+1>this.endPosition&&(this.endPosition=n+1)}},e.Processor.BeatPosition=function(e,t,n){this.bar=e===undefined?1:e,this.beat=t===undefined?1:t,this.beatsPerBar=n===undefined?16:n},e.Processor.BeatPosition.prototype={getInBeats:function(){return(this.bar-1)*this.beatsPerBar+this.beat},gotoNextBeat:function(){this.beat===this.beatsPerBar?(this.bar++,this.beat=1):this.beat++},addOffset:function(e){this.beat+=e.beat;while(this.beat>this.beatsPerBar)this.bar++,this.beat-=this.beatsPerBar;this.bar+=e.bar}},t.prototype.execute=function(t,n){var r=Object.create(this.data);t=~~(t+(this.tick-1)*(n/120)),r.duration=t+r.duration*(n/120)/1e3-t,r.duration*=1e3,e.ActionManager.onEvent(this.eventName,t,r)}}),dmaf.once("load_iterator",function(e){var t={ROUND_ROBIN:function(){return this.index++,this.index%=this.array.length,this.array[this.index]},RANDOM_FIRST:function(){return this.index===-1?this.array[Math.floor(Math.random()*this.array.length)]:this.array[++this.index]},RANDOM:function(){return this.array[Math.floor(Math.random()*this.array.length)]},SHUFFLE:function(){var e;this.A.length||(this.A=this.array.slice(0),this.B=[]);do e=Math.floor(Math.random()*this.A.length);while(this.A[e]===this.previous);return this.B.push(this.A.splice(e,1)[0]),this.previous=this.B[this.B.length-1],this.previous}};e.Iterator=function(e,n){this.index=-1,this.array=e,this.getNext=t[n],this.A=e.slice(0),this.B=[]}});