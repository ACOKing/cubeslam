var dmaf=function(e){function t(e,t,r){return e&&t&&r?M?null:(n(e,t,r),void 0):(console.log(o()),null)}function n(e,t,n){w[e]=n,n.deps=t,n.name=e}function o(){return"Dinahmoe Web Audio Framework"+(DMAF&&" version: "+DMAF.version||".")}function r(e){return A[e]||(i([e]),A[e]||{})}function i(e){for(var n,o=0,r=e.length;r>o;o++)if(n=e[o],!A[n]){if(!w[n]||!w[n].deps)return t.log&&console.log(n,"is undefined"),null;i.call(t,w[n].deps),A[n]=w[n].apply(t,c(w[n].deps))||{}}}function c(e){for(var t=[],n=0;e.length>n;n++)t.push(A[e[n]]);return t}function a(){t.dev&&x.projectPath?f(x.projectPath+"project.xml","document",d):s(),t.init=function(){t.log&&console.log("dmaf has already been initialized.")}}function s(){var e=r("DMAF");return i(["TimeManager"])?(t.dev&&(e.Settings=x),e.require=r,e.registeredModules=w,e.require("init"),void 0):g("dmaf_ready")}function u(e,t){var n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.async=!0,n.onload=function(){t(),setTimeout(function(){document.body.removeChild(n)},1)},n.src=e,document.body.appendChild(n)}function f(e,t,n){var o=new XMLHttpRequest;o.responseType=t,o.onload=function(){n(this.response)},o.open("GET",e,!0),o.send()}function d(e){var t=e.querySelector("framework"),n=e.querySelector("include");if(t=t&&t.getAttribute("path"),n=n&&n.getAttribute("scripts"),n=n&&n.split(",")||[],!t)throw new TypeError("Missing framework path.");x.customScripts=n,x.frameworkPath=t,x.configPath=x.projectPath+"config.xml",x.assetsPath=x.projectPath+"assets/";for(var o=0;n.length>o;o++)n[o]=x.assetsPath+"js/"+n[o];f(t+"src/scripts.json","text",l)}function l(e){var t,n=JSON.parse(e);n=n.concat(x.customScripts),x.files.toLoad=n.length,M=!1,console.log("Loading dmaf from:",x.frameworkPath);for(var o=0;x.files.toLoad>o;o++)t=/http/.test(n[o])?n[o]:x.frameworkPath+n[o],u(t,m)}function m(){++x.files.loaded===x.files.toLoad&&f(x.frameworkPath+"src/xml/descriptors.xml","document",p)}function p(e){x.descriptorsXML=e,f(x.configPath,"document",v)}function v(e){x.configXML=e,s()}function g(e){var n=function(){},o=r("DMAF");r("public"),o.resolveListeners(),t.init=n,o.dispatch(e||"dmaf_fail")}function h(e){var n=[],o=function(){n.push(arguments)};o.resolve=function(o){for(t[e]=o||function(){};n.length;)o.apply(t,n.shift())},t[e]=o}for(var b=!("undefined"==typeof window||!e.navigator||!e.document),j=e.location&&e.location.href.split("?")||[],y=(!(!Object.create||!Object.keys),/^dmaf\=/),w={},A={},E=["once","registerObject","unregisterObject","addEventListener","removeEventListener","tell","stop"],x={files:{loaded:0,total:0},projectPath:""},M=!1,L=0;E.length>L;L++)h(E[L]);for(t.prototype=null,t.isBrowser=b,t.failure=g,t.toString=o,t.init=a,t.dev=!1,L=0;j.length>L;L++)if(y.test(j[L])){t.dev=M=!0,x.projectPath=j[L].replace(y,"");break}return"undefined"!=typeof module&&module.exports?module.exports=t:"undefined"!=typeof define&&define("dmaf",[],function(){return t}),t}(this,"function");dmaf("DMAF",[],function(){var e={Settings:{}};return e.context=function(){function t(){return(new Date).getTime()}function n(){return e.context.currentTime=t(),setTimeout(n,40),e.context.currentTime}var o=dmaf.isBrowser&&(window.webkitAudioContext||window.AudioContext)||null;if(o){var r="createTouch"in document?"touchstart":"mousedown";return e.webAudio=!0,document.addEventListener(r,function i(){var t=e.context.createBufferSource(),n=e.context.createBuffer(1,100,44100);t.buffer=n,t.noteOn(0),document.removeEventListener(r,i,!1)},!1),new o}return Object.create?Object.create(null,{currentTime:{get:t}}):(e.webAudio=!1,{currentTime:n()})}(),e}),dmaf("public",["DMAF","ActionManager"],function(e,t){function n(n,o,r){dmaf.log&&console.log("dmaf.tell:",n),r||(r=1e3*e.context.currentTime),t.onEvent(n,r,o)}function o(e){var t=l,n=[],o=u.call(arguments,1);d=f=!1,t=l[e],t||(t=n);for(var r=0;t.length>r&&(n.push(t[r].apply(t[r].context,o)),f&&(r--,f=!1),!d);r++);return n.length?n:null}function r(e,t,n){for(var o=l[e]||(l[e]=[]),r=0,i=o.length;i>r;r++)if(o[r]===t)return t;t.context=n&&"object"==typeof n?n:dmaf,o.push(t)}function i(e,t){var n,o=l[e];if(!o||!o.length)return!1;for(n=o.length;n--;)if(o[n]==t){o.splice(n,1),f=!0;break}}function c(e,t,n){t.context=n&&"object"==typeof n?n:dmaf;var o=function(){var r=t.apply(n,arguments);return dmaf.removeEventListener(e,o),r};dmaf.addEventListener(e,o,n)}function a(n,o){return"string"!=typeof n?(dmaf.log&&console.log("DMAF: You must provide a valid id for the object you wish to register."),2):n?o&&o instanceof Object?(o.instanceId||(o.instanceId=n),e.pendingObjects[n]=o,t.onEvent(n+".CREATE"),void 0):(dmaf.log&&console.log("DMAF: You've tried to register an object not of type 'object'"),3):(dmaf.log&&console.log("DMAF: You must provide a valid id for the object you wish to register."),1)}function s(t){var n=e.pendingObjects[t],o=!1;return n&&(o=delete e.pendingObjects[t]),n=e.getInstance("customCode:"+t),n&&(o=e.removeInstance("customCode:"+t)),n=e.getInstance("mediaElement:"+t),n&&(o=e.removeInstance("mediaElement:"+t)),o&&e.ActionManager.onEvent(t+".REMOVE"),!1}var u=Array.prototype.slice,f=!1,d=!1,l={};e.dispatch=o,e.resolveListeners=function(){dmaf.once.resolve(c),dmaf.addEventListener.resolve(r),dmaf.removeEventListener.resolve(i),dmaf.stop.resolve(d),dmaf.unregisterObject.resolve(s)},e.resolveInput=function(){dmaf.tell.resolve(n),dmaf.registerObject.resolve(a)}});